<script>

    $('#customer_activity_follow').datagrid({
        local: 'remote',
        dataUrl: '/v1/newcustomer/customerlist?markid=' + aid,
        dataType: 'json',
        sortAll: false,
        loadType: 'get',
        filterAll: true,
        height: '95%',
        columns: [{name: 'completion', width: '60', label: '完成度'},
            {
                name: 'intentiontype',
                width: '95',
                label: '意向度',
                type: 'select',
                items: [{'意向客户': '意向客户'}, {'非意向': '非意向'}]
            },
            {name: 'cusname', width: '70', label: '姓名'},
            {name: 'mobile', width: '90', label: '电话'},
            {name: 'village', width: '100', label: '小区名称'},
            {
                name: 'roommodel',
                width: '70',
                label: '毛坯平层',
                type: 'select',
                items: [{'毛坯平层': '毛坯平层'}, {'旧房平层': '旧房平层'}, {'复式毛坯': '复式毛坯'}, {'跃层毛坯': '跃层毛坯'}, {'排屋毛坯': '排屋毛坯'}, {'别墅毛坯': '别墅毛坯'}, {'其他': '其他'}, {'NO':'未填写'}]
            },
            {
                name: 'newbudget',
                width: '70',
                label: '预算',
                type: 'select',
                items: [{'7万以下': '7万以下'}, {'7万': '7万'}, {'8万': '8万'}, {'9万': '9万'}, {'10万': '10万'}, {'11万': '11万'}, {'12万': '12万'}, {'13万': '13万'}, {'14万': '14万'}, {'15万': '15万'}, {'15万以上': '15万以上'}, {'NO':'未填写'}]
            },
            {name: 'area', width: '70', label: '面积'},
            {name: 'roomstatus', width: '70', label: '交房状态', type: 'select', items: [{'现房': '现房'}, {'期房': '期房'}, {'NO':'未填写'}]},
            {name: 'followdate', width: '100', label: '最后一次跟进时间'},
            {name: 'followdetails', width: '200', label: '最后一次跟进内容'},
            {
                name: 'state',
                width: '90',
                label: '状态',
                type: 'select',
                items: [{'新增': '新增'},{'待跟进': '待跟进'}, {'已邀约': '已邀约'}, {'已分配': '已分配'}, {'已签到': '已签到'}, {'接待中': '接待中'},{'已付定金': '已付定金'},{'已签约': '已签约'},{'施工中': '施工中'},{'已竣工': '已竣工'}]
            },
            {name: 'details', width: '150', label: '备注(关注点)'},
            {name: 'marketactive', width: '150', label: '到场时间'},
            {name: 'record', width: '150', label: '来源备注'},
            {name: 'source', width: '70', label: '报名渠道来源'},
			{name: 'mobilesalesdepname', width: '70', label: '渠道部门',id:'mobilesalesdepname',type:'select',items:function(){
				if (mobilesalesdepname_content == undefined){
					mobilesalesdepname_content = new Array();
					$.ajax({
						url: '/v1/other/getorgdepdeatil?pid=40',
						dataType: 'json',
						async: false,
						type: 'GET',
						xhrFields: {
							withCredentials: true
						},
						crossDomain: true,
						success: function (d) {
							if (d.state == 200){
								mobilesalesdepname_data = d.data;
								var c
								for (var i = 0 ; i < d.data.length; i ++){
									var b = d.data[i].org_name;
									c = new Object();
									c[b]= b;
									mobilesalesdepname_content.push(c)
								}
							}
						}
					});
				}
				return mobilesalesdepname_content;
			}},
			{name: 'mobilesales', width: '70', label: '美客员',type:'select',items:function(){
				if (mobilesales_content == undefined){
					mobilesales_content = new Array();
					$.ajax({
						url: '/v1/user/getdepcode_userlist?code=001002010',
						dataType: 'json',
						async: false,
						type: 'GET',
						xhrFields: {
							withCredentials: true
						},
						crossDomain: true,
						success: function (d) {
							if (d.state == 200){
								var c
								for (var i = 0 ; i < d.data.length; i ++){
									var b = d.data[i].flower_name;
									c = new Object();
									c[b]= b;
									mobilesales_content.push(c)
								}
							}
						}
					});
				}
				return mobilesales_content;
			}},
			{name: 'custsalesdepname', width: '70', label: '销售部门',type:'select',items:function(){
				if (custsalesdepname_content == undefined){
					custsalesdepname_content = new Array();
					$.ajax({
						url: '/v1/other/getorgdepdeatil?pid=37',
						dataType: 'json',
						async: false,
						type: 'GET',
						xhrFields: {
							withCredentials: true
						},
						crossDomain: true,
						success: function (d) {
							if (d.state == 200){
								custsalesdepname_data = d.data
								var c
								for (var i = 0 ; i < d.data.length; i ++){
									var b = d.data[i].org_name;
									c = new Object();
									c[b]= b;
									custsalesdepname_content.push(c)
								}
							}
						}
					});
				}
				return custsalesdepname_content;
			}},
			{name: 'custsales', width: '70', label: '客户经理',type:'select',items:function(){

				if (custsales_content == undefined){
					custsales_content = new Array();
					$.ajax({
						url: '/v1/user/getdepcode_userlist?code=001002007',
						dataType: 'json',
						async: false,
						type: 'GET',
						xhrFields: {
							withCredentials: true
						},
						crossDomain: true,
						success: function (d) {
							if (d.state == 200){
								var c
								for (var i = 0 ; i < d.data.length; i ++){
									var b = d.data[i].flower_name;
									c = new Object();
									c[b]= b;
									custsales_content.push(c)
								}
							}
						}
					});
				}
				return custsales_content;
			}},
			{name: 'firstamout', width: '70', label: '预定金'},
			{name: 'orgname', width: '70', label: '组织'},
			{name: 'createtime', width: '150', label: '创建时间'},
			{name: 'lasttime', width: '150', label: '更新时间'},
		],
		paging: {pageSize: 50, selectPageSize: '50,100,200', pageCurrent: 1},
		hiddenFields: ['id','mobilesalesid'],
		columnMenu: true,
		columnShowhide: true,
		columnFilter: true,
		columnLock: false,
		fullGrid: false,
		headSureBack:'activity_headSureBack'
	});

	function activity_headSureBack() {
		$("select[name='mobilesalesdepname']").change(function() {
			var mt = $("select[name='mobilesalesdepname'] option:selected").val()
			var index= $("select[name='mobilesalesdepname']").get(0).selectedIndex
			var code;
			if (index == 0){
				code = '001002010';
			}else{
				code = mobilesalesdepname_data[index - 1].depcode;
			}
			depname_ajax($("select[name='mobilesales']"),code);

		});

		$("select[name='custsalesdepname']").change(function() {
			var mt = $("select[name='custsalesdepname'] option:selected").val()
			var index= $("select[name='custsalesdepname']").get(0).selectedIndex
			var code;
			if (index == 0){
				code = '001002007';
			}else{
				code = custsalesdepname_data[index - 1].depcode;
			}
			depname_ajax($("select[name='custsales']"),code);
		});
	}

	function depname_ajax(selectpicker,code) {

		$.ajax({
			url: '/v1/user/getdepcode_userlist',
			dataType: 'json',
			type: 'GET',
			data:{
				code:code
			},
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			success: function (d) {
				if (d.state == 200) {
					selectpicker.find('option').remove();
					selectpicker.append($('<option value="">全部</option>'));
					$.each(d.data, function (i) {
						selectpicker.append($("<option value=" + d.data[i].flower_name + ">" + d.data[i].flower_name + "</option>"));
					});
					selectpicker.selectpicker('refresh');
				}
			}
		});
	}

</script>


<table id="customer_activity_follow" class="table table-hover" data-width="100%"></table>