<script type="text/javascript">
	$.ajax({
		url: '/v1/roledata/get_role?ids=' + datas_id,
		dataType: 'json',
		type: 'GET',
		xhrFields: {
			withCredentials: true
		},
		crossDomain: true,
		success: function (d) {
			var num = 0;
			$.each(d.data, function (index, item) {
				if (index == "dataaccessid") {
					$.CurrentDialog.find("#roledata_" + formItems[num]).selectpicker('val', item);
				} else if (index == "isdel") {
					$.CurrentDialog.find("#roledata_" + formItems[num]).selectpicker('val', item == true ? 1 : 0);
				} else {
					$.CurrentDialog.find("#roledata_" + formItems[num]).val(item);
				}
				num++;
			});
		}
	});


	function pic_upload_success(file, data) {
		var json = $.parseJSON(data)

		$(this).bjuiajax('ajaxDone', json)
		if (json[BJUI.keys.statusCode] == BJUI.statusCode.ok) {
			$('#j_custom_pic').val(json.filename).trigger('validate')
			$('#j_custom_span_pic').html('<img src="' + json.filename + '" width="100" />')
		}
	}
	function do_OK(json, $form) {
		console.log(json)
		console.log($form)
	}

	function S_NodeCheck(e, treeId, treeNode) {
		var zTree = $.fn.zTree.getZTreeObj(treeId),
				nodes = zTree.getCheckedNodes(true)
		var ids = '', names = ''

		for (var i = 0; i < nodes.length; i++) {
			ids += ',' + nodes[i].id
			names += ',' + nodes[i].name
		}
		if (ids.length > 0) {
			ids = ids.substr(1), names = names.substr(1)
		}

		var $from = $('#' + treeId).data('fromObj')

		if ($from && $from.length) $from.val(names)
		$('#' + treeId + '_select_box').hide();
		$("#personnel_roleid").val(treeNode.id);
		console.log(treeNode.id);

		$.ajax({
			url: '/v1/other/getorgdep?pid=' + treeNode.pId,
			dataType: 'json',
			type: 'get',
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			success: function (d) {
				$("#personnel_orgname").val(d.data[0]["be_orgname"]);
				$("#personnel_depname").val(d.data[0]["org_name"]);
			}
		});
	}

	function S_NodeClick(event, treeId, treeNode) {
		var zTree = $.fn.zTree.getZTreeObj(treeId)

		zTree.checkNode(treeNode, !treeNode.checked, true, true)

		event.preventDefault()
	}

	function wtf(json) {
		if (json.state == 200) {
			BJUI.dialog('closeCurrent', this);
			$('#roledata_datagrid').datagrid('refresh');
		}
	}


</script>
<div class="bjui-pageContent">
	<form action="/v1/roledata/edit_role" data-toggle="validate" data-callback="wtf">
		<input type="hidden" id="roledata_id" value="" name="id" size="15">
		<table class="table table-condensed table-hover" width="100%">
			<tbody>
			<tr>
				<td>
					<label for="roledata_roleName" class="control-label x90">角色名：</label>
					<input type="text" id="roledata_roleName" value="" data-rule="required" name="roleName" size="15">
				</td>
				<td>
					<label for="roledata_dataaccessid" class="control-label x90">角色权限：</label>
					<select name="dataaccessid" id="roledata_dataaccessid" data-toggle="selectpicker"
							onchange="changeDataAccess()">
						<option value="4">个人</option>
						<option value="5">部门</option>
						<option value="6">组织</option>
						<option value="7">所有组织</option>
					</select>
					<input type="hidden" id="roledata_dataaccess" value="个人" data-rule="required" name="dataaccess"
						   size="15">
				</td>

			</tr>
			<tr>
				<td>
					<label for="roledata_isdel" class="control-label x90">是否删除：</label>
					<select name="isdel" id="roledata_isdel" data-toggle="selectpicker">
						<option value="0">否</option>
						<option value="1">是</option>
					</select>
				</td>
				<td colspan="">
					<label for="roledata_description" class="control-label x90">描述：</label>
					<textarea name="description" id="roledata_description" data-toggle="autoheight" cols="20"
							  rows="3"></textarea>
				</td>
			</tr>
			</tbody>
		</table>
	</form>
</div>
<div class="bjui-pageFooter">
	<ul>
		<li>
			<button type="button" class="btn-close" data-icon="close">取消</button>
		</li>
		<li>
			<button type="submit" class="btn-default" data-icon="save">保存</button>
		</li>
	</ul>
</div>