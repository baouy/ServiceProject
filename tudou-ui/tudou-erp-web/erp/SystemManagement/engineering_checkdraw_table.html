<html>

<head>
    <style>
        .checkdraw_img {
            max-width: 200px;
            max-height: 200px;
        }

        .image_id {
            width: 25px;
            height: 25px;
            line-height: 25px;
            text-align: center;
            font-size: large;
            font-weight: 500;
            background: #c0c0c0;
            float: left;
            color: #fff;
        }

        .image_id2 {
            color: #0f4c0f;
        }
    </style>
    <script type="text/javascript">

        //拉出所有未审核图片
        $.ajax({
            url: '/v1/reviewdpicture/imagelist?to=' + groupid + "&msgtimestamp=" + starttime + "&isaudit=" + false,
            type: 'GET',
            xhrFields: {
                withCredentials: true
            },
            crossDomain: true,
            success: function (res) {
                createImagePageTable(res.data)
//                $('#engineering_checkdraw_datagrid_pagination').pagination({
//                    width: '50%',
//                    total:res.total,
//                    pageCurrent:1,
//                    pageSize:res.pageSize,
//                    showPagenum:5,
//                    form:'#pagerForm',
//                    page:true
//                });
//                $('#engineering_checkdraw_datagrid_pagination').find(".jumpto").remove();
            }
        });

        function createImagePageTable(datas) {
            var size = 8;
            $("#engineering_checkdraw_datagrid").empty();
            for (var i = 0; i < datas.length; i = i + size) {
                var html = "<tr>"
                for (var j = i; j < size + i; j++) {
                    if (!datas[j]) break;
                    var attach = eval("(" + datas[j].attach + ")");

//                    html += "<td class='image_td' style='text-align: center;border: 1px solid #c0c0c0'>" +
//                            "<div class='image_id'>√<input type='hidden'name ='image_id' value='" + datas[j].id + "'/></div>" +
//                            "<div style='width: 200px;height: 200px;'><img class='checkdraw_img' src='" + attach.url + "'/></div>" +
//                            "</td>";
                    html += "<td class='image_td' witch='20%'>" +
                            "<div class='image_id'>√<input type='hidden'name ='image_id' value='" + datas[j].id + "'/></div>" +
                            "<div><img class='checkdraw_img' src='" + attach.url + "'/></div>" +
                            "</td>";
                }
                html += "</tr>";
                $("#engineering_checkdraw_datagrid").append(html);
            }
        }

        $(function () {
            $("#engineering_checkdraw_datagrid").on('click', '.image_td', function () {
                $(this).find('.image_id').toggleClass("image_id2");
            });

        });
        $('#engineering_checkdraw_datagrid_record').datagrid({

            height: '95%',
            dataUrl: '/v1/reviewdpicture/list2?tcid=' + tcid,
            dataType: 'json',
            loadType: 'get',
            sortAll: false,
            filterAll: true,
            height: '95%',
            columns: [
                {name: 'cusname', width: '90', label: '姓名'},
                {name: 'realstatedate', width: '120', label: '开工时间'},
                {name: 'createtime', width: '80', label: '上传时间'},
                {name: 'jobcontent', width: '80', label: '施工阶段'},
                {
                    name: 'state',
                    width: '80',
                    items: [{'0': '待审核'}, {'1': '审核通过'}, {'2': '审核未通过'}, {'3': '已发布'}, {'4': '已下架'}],
                    label: '当前状态'
                },
                {name: 'reason', width: '80', label: '原因'},

                {name: 'signtype', width: '80', label: '备注'},
                {name: 'groupid', width: '80', label: '群id', hide: true},

                {name: 'id', width: '80', label: '主键', hide: true}],
            paging: {
                pageSize: 20,
                selectPageSize: '50,80',
                pageCurrent: 1
            },
            columnMenu: true,
            columnShowhide: true,
            columnFilter: true,
            columnLock: false,
            fullGrid: false,
        });


        //审核通过
        function reviewedpass() {
            var ids = [];
            var obj = new Object();
            for (var i = 0; i < $(".image_id2").length; i++) {
                ids.push($(".image_id2").find("input[name='image_id']")[i].value);
            }

            obj = {
                id,//签到id
                state: 1,
                ids//图片id数组
            }
            $.ajax({
                url: '/v1/reviewdpicture/reviewd',
                contentType: 'application/json',
                dataType: 'json',
                type: 'POST',
                data: JSON.stringify(obj),
                xhrFields: {
                    withCredentials: true
                },
                crossDomain: true,
                success: function (d) {
                    if (d.state == 200) {
                        BJUI.alertmsg('info', d.content, {
                            displayMode: 'fade',
                            alertTimeout: 1000,
                            displayPosition: 'middlecenter'
                        });
                        $("#pass").attr("disabled", "disabled");
                        $("#nopass").attr("disabled", "disabled");
                        $("#put").removeAttr("disabled");
                        $('#picture_reviewed_list').datagrid("refresh");
                        $('#picture_reviewed_list2').datagrid("refresh");
                        $('#engineering_checkdraw_datagrid_record').datagrid("refresh");

                    } else {
                        BJUI.alertmsg('info', d.content, {
                            displayMode: 'fade',
                            alertTimeout: 1000,
                            displayPosition: 'middlecenter'
                        });
                    }
                }
            });
        }

        //审核不通过
        function reviewednopass(reason) {
//            var ids = [];
            var obj = new Object();
//            for (var i = 0; i < $(".image_id2").length; i++) {
//                ids.push($(".image_id2").find("input[name='image_id']")[i].value);
//            }

            obj = {
                id,
                state: 2,
                reason: reason
            }
            $.ajax({
                url: '/v1/reviewdpicture/reviewd',
                contentType: 'application/json',
                dataType: 'json',
                type: 'POST',
                data: JSON.stringify(obj),
                xhrFields: {
                    withCredentials: true
                },
                crossDomain: true,
                success: function (d) {
                    if (d.state == 200) {
                        BJUI.alertmsg('info', d.content, {
                            displayMode: 'fade',
                            alertTimeout: 1000,
                            displayPosition: 'middlecenter'
                        });
                        $("#pass").attr("disabled", "disabled");
                        $("#nopass").attr("disabled", "disabled");
                        $('#picture_reviewed_list').datagrid("refresh");
                        $('#picture_reviewed_list2').datagrid("refresh");
                        $('#engineering_checkdraw_datagrid_record').datagrid("refresh");

                    } else {
                        BJUI.alertmsg('info', d.content, {
                            displayMode: 'fade',
                            alertTimeout: 1000,
                            displayPosition: 'middlecenter'
                        });
                    }
                }
            });
        }
        //发布
        function reviewedput() {
            var ids = [];
            var obj = new Object();
            for (var i = 0; i < $(".image_id2").length; i++) {
                ids.push($(".image_id2").find("input[name='image_id']")[i].value);
            }

            obj = {
                id,//签到id
                ids,
                state: 3,
                tcid:tcid,//合同id

            }

            $.ajax({
                url: '/v1/reviewdpicture/reviewd',
                contentType: 'application/json',
                dataType: 'json',
                type: 'POST',
                data: JSON.stringify(obj),
                xhrFields: {
                    withCredentials: true
                },
                crossDomain: true,
                success: function (d) {
                    if (d.state == 200) {
                        BJUI.alertmsg('info', d.content, {
                            displayMode: 'fade',
                            alertTimeout: 1000,
                            displayPosition: 'middlecenter'
                        });
                        $("#put").attr("disabled", "disabled");
                        $('#picture_reviewed_list').datagrid("refresh");
                        $('#picture_reviewed_list2').datagrid("refresh");
                        $('#engineering_checkdraw_datagrid_record').datagrid("refresh");

                    } else {
                        BJUI.alertmsg('info', d.content, {
                            displayMode: 'fade',
                            alertTimeout: 1000,
                            displayPosition: 'middlecenter'
                        });
                    }
                }
            });
        }
        //下架
        function reviewednoput(reason) {
            var ids = [];
            var obj = new Object();
            for (var i = 0; i < $(".image_id2").length; i++) {
                ids.push($(".image_id2").find("input[name='image_id']")[i].value);
            }

            obj = {
                id,
                ids,
                state: 4,
                reason:reason
            }

            $.ajax({
                url: '/v1/reviewdpicture/reviewd',
                contentType: 'application/json',
                dataType: 'json',
                type: 'POST',
                data: JSON.stringify(obj),
                xhrFields: {
                    withCredentials: true
                },
                crossDomain: true,
                success: function (d) {
                    if (d.state == 200) {
                        BJUI.alertmsg('info', d.content, {
                            displayMode: 'fade',
                            alertTimeout: 1000,
                            displayPosition: 'middlecenter'
                        });
                        $("#pass").attr("disabled", "disabled");
                        $("#nopass").attr("disabled", "disabled");
                        $("#noput").attr("disabled", "disabled");
                        $('#picture_reviewed_list').datagrid("refresh");
                        $('#picture_reviewed_list2').datagrid("refresh");
                        $('#engineering_checkdraw_datagrid_record').datagrid("refresh");

                    } else {
                        BJUI.alertmsg('info', d.content, {
                            displayMode: 'fade',
                            alertTimeout: 1000,
                            displayPosition: 'middlecenter'
                        });
                    }
                }
            });
        }



        function reviewed_pass() {
            $(this).alertmsg('confirm', '确定审核通过吗',
                    {
                        displayMode: 'slide',
                        displayPosition: 'middlecenter',
                        cancelName: '关闭',
                        okName: '确认',
//                        title: '删除',
                        okCall: 'reviewedpass'
                    });

        }
        function reviewed_put() {
            $(this).alertmsg('confirm', '确定发布吗',
                    {
                        displayMode: 'slide',
                        displayPosition: 'middlecenter',
                        cancelName: '关闭',
                        okName: '确认',
//                        title: '删除',
                        okCall: 'reviewedput'
                    });

        }

        function reviewed_nopass() {
            $(this).dialog({
                id: "reason",
                title: "填写原因",
                url: "SystemManagement/reason_nopass.html",
                width: 400,
                height: 400,
                mask: true
            });

        }
        function reviewed_noput() {
            $(this).dialog({
                id: "reason",
                title: "填写原因",
                url: "SystemManagement/reason_noput.html",
                width: 400,
                height: 400,
                mask: true
            });

        }

    </script>
</head>
<body>
<div class="bjui-pageContent">

    <form data-toggle="validate" data-toggle="validate">


        <table id="engineering_checkdraw_datagrid" class="table table-hover" data-width="100%"></table>
        <div style="margin:0px 0px 10px 0px;">
            <button class="btn btn-green" data-icon="thumbs-up" onclick="reviewed_pass()" id="pass">审核通过</button>
            <button class="btn btn-red" data-icon="thumbs-down" onclick="reviewed_nopass()" id="nopass">审核不通过</button>
            <button class="btn btn-green" data-icon="thumbs-up" onclick="reviewed_put()" id="put" disabled="disabled">发布</button>
            <button class="btn btn-red" data-icon="thumbs-down" onclick="reviewed_noput()" id="noput">下架</button>
        </div>
        <table id="engineering_checkdraw_datagrid_record" class="table table-hover"
               style="height: 100%;"></table>
    </form>
</div>
</body>
</html>