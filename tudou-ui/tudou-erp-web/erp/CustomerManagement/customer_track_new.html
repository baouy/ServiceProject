<html>

<head>
    <script type="text/javascript">

$('#customer_datagrid').datagrid({

    local: 'remote',
    dataUrl: '/v1/customer/customerlist',
    dataType: 'json',
    sortAll: false,
    loadType: 'get',
    filterAll: true,
	height:'95%',
    columns: [{name:'customercode', width:'150', label:'编码'}, 
      {name:'cusname', width:'150', label:'姓名'},
      {name:'mobile', width:'150', label:'手机号'}, 
      {name:'state', width:'150', label:'状态'}, 
      {name:'orgname', width:'150', label:'组织'}, 
      {name:'stores', width:'150', label:'门店'}, 
      {name:'mobilesales', width:'150', label:'美聊员'},
      {name:'custsales', width:'150', label:'客户经理'},
      {name:'designer', width:'150', label:'设计师'},
      {name:'cityname', width:'150', label:'城市'},
      {name:'community', width:'150', label:'小区名称'},
      {name:'isverify',items:[{'true':'已验证'}, {'false':'未验证'}], width:'150', label:'验证'},
      {name:'source', width:'150', label:'来源'},
      {name:'maxfollowsnum', width:'150', label:'回访次数'},
      {name:'scaledate', width:'150', label:'量尺时间'},
      {name:'createuser', width:'150', label:'创建人'},
      {name:'createtime', width:'150', label:'创建时间'},
      {name:'lastuser', width:'150', label:'最后修改人'},
      {name:'lasttime', width:'150', label:'最后修改时间'}],
    paging: {pageSize:20, selectPageSize:'50,100,200', pageCurrent:1},
    columnMenu: true,
    columnShowhide: true,
    columnFilter: true,
    columnLock: false,
    fullGrid: false,


});

$('#customer_datagrid').datagrid('refresh');

var formItems = ["id",
"flowerName",
"loginName",
"orgname",
"depname",
"rolename",
"roleid",
"username",
"email",
"mobile",
"entryDate",
"userlevel",
"isactive",
"idNumber",
"gender",
"birthday",
"address",
"national",
"school",
"education",
"politicalLand",
"emerContact",
"emerPhone",
"hobby",
"departureDate",
"note"
];

function checkDialog($dialog){
    var selected=$("#personnel_datagrid").find('tr.datagrid-selected-tr');
    if(selected.length == 0){
        $dialog.alertmsg('error', '请在列表中选择要操作的对象。');
        this.close($dialog);
    }else if(selected.length > 1){
        $dialog.alertmsg('error', '请选择唯一的操作对象。');
        this.close($dialog);
    }else{
        if(selected[0].lastChild.innerText>0){
            $.ajax({
                url: '/v1/personnel/get_personnel?ids='+selected[0].lastChild.innerText,
                dataType: 'json',
                type: 'GET',
                xhrFields: {
                    withCredentials: true
                },
                crossDomain: true,
                success: function(d){
                    var num = 0;
                    $.each(d.data,function(index,item){
                        //console.log(num+" "+index+" "+item+" "+formItems[num]);
                        if(index == "isactive"){
                            if(item==true){
                                $dialog.find("#personnel_isactive1").iCheck('check');
                            }
                            else
                            {
                                $dialog.find("#personnel_isactive2").iCheck('check');
                            }
                        }
                        else if(index == "gender"){
                            if(item=="男"){
                                $dialog.find("#personnel_gender1").iCheck('check');
                            }
                            else
                            {
                                $dialog.find("#personnel_gender2").iCheck('check');
                            }
                        }
                        else{
                            $dialog.find("#personnel_"+formItems[num]).val(item);
                        }                       
                        num++;
                    })
                }
            }); 
        }
    }
}

function getselectedKey(){
    var selected=$("#personnel_datagrid").find('tr.datagrid-selected-tr');
    var selectedKey="";
    selected.each(function(index,item){
        selectedKey+=item.lastChild.innerText+",";
    });
    selectedKey=selectedKey.substring(0, selectedKey.length - 1);
    return selectedKey;
}

function resetPW(){
    var resetKeys=getselectedKey();
    if(resetKeys.length>0){
        $.ajax({
            url: '/v1/personnel/resetpassword?ids='+resetKeys,
            dataType: 'json',
            type: 'POST',
            xhrFields: {
                withCredentials: true
            },
            crossDomain: true,
            success: function(d){
                if(d.state == 200){
                    $("body").alertmsg('info', '操作成功');
                    $('#personnel_datagrid').datagrid('refresh');
                }
            }
        });
    }
    else{
        $("body").alertmsg('error', '请选择要操作的对象。')
    }
}

function deleteItems(){
    deleteKeys=getselectedKey();
    if(deleteKeys.length>0){
        $.ajax({
            url: '/v1/personnel/delete_personnel?ids='+deleteKeys,
            dataType: 'json',
            type: 'POST',
            xhrFields: {
                withCredentials: true
            },
            crossDomain: true,
            success: function(d){
                if(d.state == 200){
                    $("body").alertmsg('info', '操作成功');
                    $('#personnel_datagrid').datagrid('refresh');
                }
            }
        });
    }
    else{
         $("body").alertmsg('error', '请选择要操作的对象。')       
    }
}

</script>
</head>

<body>
    <div class="bjui-pageContent">
        <div style="margin:15px;">
            <button class="btn-default" data-url="CustomerManagement/customer_track_remind.html" data-width="1050" data-height="400" data-toggle="dialog" data-id="personnel_n" data-mask="true">提醒客户经理</button>
            <button class="btn-default" data-url="CustomerManagement/customer_track_remind.html" data-width="1050" data-height="400" data-toggle="dialog" data-id="personnel_n" data-mask="true">提醒设计师</button>
        </div>
        <table id="customer_datagrid" class="table table-hover" data-width="100%"> </table>
    </div>
</body>

</html>