<!DOCTYPE html>
<html lang="en">
<head>
    <script type="text/javascript">
        var custId;
        var select_enter = $(".navtab-tab .active").children("a").attr("title");//判断是哪个菜单列表进入的

        switch (select_enter) {
            case "目标客户档案":
                var sel = $("#customer_list_tabel").find('tr.datagrid-selected-tr');
                getContractData(sel);
                break;
            case "客户档案(设计)":
                $("#customer_constract_btn button").removeClass("hide");
                var sel = $("#customer_designList").find('tr.datagrid-selected-tr');
                getContractData(sel);
                break;
            case "客户档案(电销)":
                if($("#btn_list .active").children("a").text() == "需跟进客户") {
                    var sel = $("#customer_telephonesales_1").find('tr.datagrid-selected-tr');
                    getContractData(sel);
                } else if($("#btn_list .active").children("a").text() == "已转销售"){
                    var sel = $("#customer_telephonesales_2").find('tr.datagrid-selected-tr');
                    getContractData(sel);
                } else if($("#btn_list .active").children("a").text() == "回收池"){
                    var sel = $("#customer_telephonesales_3").find('tr.datagrid-selected-tr');
                    getContractData(sel);
                } else if($("#btn_list .active").children("a").text() == "新客户"){
                    var sel = $("#customer_telephonesales").find('tr.datagrid-selected-tr');
                    getContractData(sel);
                }
                break;
            case "客户档案(销售)":
                if($("#customer_sale_menuTab .active").children("a").text()=="销售跟进"){
                    var sel = $("#customer_sales").find('tr.datagrid-selected-tr');
                    getContractData(sel);
                }else if($("#customer_sale_menuTab .active").children("a").text()=="已成交"){
                    var sel = $("#customer_sales_2").find('tr.datagrid-selected-tr');
                    getContractData(sel);
                }else if($("#customer_sale_menuTab .active").children("a").text()=="回收池"){
                    var sel = $("#customer_sales_3").find('tr.datagrid-selected-tr');
                    getContractData(sel);
                }
                break;
            case "成交跟进":
                var sel = $("#complete_follow").find('tr.datagrid-selected-tr');
                getContractData(sel);
                break;

            default:
                break;
        };

        function getContractData(sel){
            if (sel.length == 0) {
                BJUI.alertmsg('error', '请在列表中选择要操作的对象。');
                BJUI.dialog('closeCurrent',this);
            } else if (sel.length > 1) {
                BJUI.alertmsg('error', '请选择唯一的操作对象。');
                BJUI.dialog('closeCurrent',this);
            } else {
                $('#customer_contract_table').datagrid({
                    local: 'remote',
                    dataUrl: '/v1/contract/customer_contractlist?custid_fk='+sel[0].lastChild.innerText,
                    dataType: 'json',
                    sortAll: false,
                    loadType: 'get',
                    filterAll: true,
					height:'95%',
                    columns: [
                        {name: 'contractdate', width: '150', label: '合同日期'},
                        {name: 'stores', width: '150', label: '门店'},
                        {name: 'contractdoc', width: '150', label: '合同号'},
                        {name: 'contractamount', width: '150', label: '订单金额'},
                        {name: 'firstamount', width: '150', label: '首付金额'},
                        {name: 'state', width: '150', label: '状态'},
                        {name: 'projectstate', width: '150', label: '进度状态'},
                        {name: 'id', width: '80', label: '主键', hide: true}
                    ],
                    templateWidth: 600,
                    showLinenumber: true,
                    paging: {pageSize: 50, selectPageSize: '50,100,200', pageCurrent: 1},
                    columnMenu: true,
                    columnShowhide: true,
                    columnFilter: true,
                    columnLock: false,
                    fullGrid: false,

                });
            }
        }
    </script>
</head>
<body>
<div class="bjui-pageContent">
    <div style="margin:15px;" id="customer_constract_btn">
        <!--<button class="btn-default hide" data-url="FinancialManagement/financil_contract_new.html" data-toggle="dialog" data-id="customer_contract_add" data-mask="true" data-width="1050" data-height="600">新增</button>-->
        <!--<button class="btn-default hide" data-url="CustomerManagement/customer_contract_edit.html" data-width="600" data-height="400" data-toggle="dialog" data-id="customer_constract_edit" data-mask="true">修改</button>-->
    </div>
    <table class="table table-hover" data-width="100%" id="customer_contract_table">
    </table>
</div>
</body>
</html>