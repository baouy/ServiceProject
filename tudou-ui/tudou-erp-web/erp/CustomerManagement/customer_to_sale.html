<html>
<head>
	<script type="text/javascript">
		$('#insales').datagrid({
			local: 'remote',
			dataUrl: '/v1/user/saleslist?type=0',
			dataType: 'json',
			sortAll: false,
			loadType: 'get',
			filterAll: true,
			height:'95%',
			columns: [
				{name: 'userlevel', width: '150', label: '等级'},
				{name: 'login_name', width: '150', label: '编码'},
				{name: 'flower_name', width: '150', label: '花名'},
				{name: 'username', width: '150', label: '姓名'},
				{name: 'follownum', width: '150', label: '在跟进数'},
				{name: 'orgname', width: '150', label: '部门'},
				{name: 'depname', width: '150', label: '组织'},
				{name: 'depcode', width: '150', label: '组织id', hide: true},
				{name: 'id', width: '80', label: '主键', hide: true}],
			paging: {pageSize: 50, selectPageSize: '50,100,200', pageCurrent: 1},
			columnMenu: true,
			columnShowhide: true,
			columnFilter: true,
			columnLock: false,
			fullGrid: false,
			dblOnClick: 'intelephonesales',

		});

		//转销售
		function intelephonesales() {
			var id, selected_customer_id, flower_name, depcode;
			var enter = $(".navtab-tab .active").children("a").attr("title");//判断是哪个菜单列表进入的
			selected_customer_id = $("#insales .datagrid-selected-tr>td:last-child").text(); //转电销列表中选中记录的id
			flower_name = $("#insales .datagrid-selected-tr>td:eq(3)").text();//花名
			depcode = $("#insales .datagrid-selected-tr>td").last().prev().text();//部门id

			if (selected_customer_id == 0) {
				$(this).alertmsg('error', '请在列表中选择要操作的对象。');
				return;
			}

			switch (enter) {
				case "目标客户档案":
					id = customer_table_getselectedKey(); //客户id
					break;
				case "客户档案(前台)":
					id = customer_reception_list_getselectedKey();
					break;
				case "客户档案(销售)":
					if ($("#customer_sale_menuTab .active").children("a").text() == "销售跟进") {
						id = customer_sales_getselectedKey("customer_sales"); //客户id
					}
					break;
				case "客户档案(美聊)":
					if ($("#btn_list .active").children("a").text() == "新客户") {
						id = customer_telephonesales_getselectedKey("customer_telephonesales"); //客户id
					}
					else if($("#btn_list .active").children("a").text() == "已转销售")
					{
					id = customer_telephonesales_getselectedKey("customer_telephonesales_2"); //客户id
				}
					break;
				case "客户档案(渠道)":
					if ($("#channel_list .active").children("a").text() == "未成交") {
						id = customer_channel_getselectedKey("customer_channel_tabel"); //客户id
					}
					else if($("#channel_list .active").children("a").text() == "已成交")
					{
						id = customer_channel_getselectedKey("customer_channel_sales"); //客户id
					}
					break;
				default :
					break;
			}

			$.ajax({
				url: '/v1/customer/customer_insales',
				dataType: 'json',
				type: 'POST',
				data: {
					id: selected_customer_id,
					flower_name: flower_name,
					ids: id,
					depcode: depcode
				},
				xhrFields: {
					withCredentials: true
				},
				crossDomain: true,
				success: function (d) {
					if(d.state != 200){
						$(this).alertmsg('error', '操作失败');
						return;
					}
					BJUI.dialog('closeCurrent', this);
					switch (enter) {
						case "目标客户档案":
							$("#customer_state").val("已转销售");
							$("#customer_mobilesales").val(flower_name);
							$('#customer_list_tabel').datagrid('refresh');
							break;
						case "客户档案(前台)":
							$('#customer_reception_list').datagrid('refresh');
							break;
						case "客户档案(销售)":
							if ($("#customer_sale_menuTab .active").children("a").text() == "销售跟进") {
								$('#customer_sales').datagrid('refresh');
							}
							break;
						case "客户档案(美聊)":
							if ($("#btn_list .active").children("a").text() == "新客户") {
								$('#customer_telephonesales').datagrid('refresh');
							}
							else if ($("#btn_list .active").children("a").text() == "已转销售"){
								$('#customer_telephonesales_2').datagrid('refresh');
							}
							break;
						case "客户档案(渠道)":
							if ($("#channel_list .active").children("a").text() == "未成交") {
								$('#customer_channel_tabel').datagrid('refresh');
							}
							else if($("#channel_list .active").children("a").text() == "已成交")
							{
								$('#customer_channel_sales').datagrid('refresh');
							}
							break;
						default :
							break;
					}
				}
			});
		}
	</script>
</head>
<body>
<div class="bjui-pageContent">
	<form>
		<button type="button" class="btn btn-blue" data-icon="plus" onclick="intelephonesales()"><i
				class="fa fa-plus"></i>选择
		</button>
		<button type="button" class="btn-close btn" data-icon="close"><i class="fa fa-close"></i> 关闭</button>
		<table id="insales" class="table table-hover" data-width="100%" data-selected-multi="true">

		</table>
	</form>
</div>
</body>
</html>