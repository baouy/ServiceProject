<script type="text/javascript">
	$('#customer_check_list').datagrid({
		local: 'remote',
		dataUrl: '/v1/customer/customer_desingerfilelist?type=12',
		dataType: 'json',
		sortAll: false,
		loadType: 'get',
		filterAll: true,
		height: '95%',
		columns: [
			{name: 'state', width: '150', label: '状态'},
			{name: 'createtime', width: '150', label: '提交时间'},
			{name: 'custname', width: '150', label: '客户姓名'},
			{name: 'createuser', width: '150', label: '提交人'},
			{name: 'style', width: '150', label: '风格'},
			{name: 'point', width: '150', label: '特点'},
			{name: 'details', width: '150', label: '备注'},
			{
				name: 'filename', width: '210', label: '上传文件',
				render: function (val) {
					var img = val.split(",");
					var str = '';
					for (var i = 0; i < img.length; i++) {
						var a = img[i] + '?imageView2/1/w/70/h/70/interlace/1/q/100';
						str += '<img id="fimgShow" height="70" width="70" src=\"' + a + '\" >';
					}
					return str;
				}
			},
			{name: 'id', width: '80', label: '主键', hide: true}
		],
		showLinenumber: true,
		paging: {pageSize: 20, selectPageSize: '50,100,200', pageCurrent: 1},
		columnMenu: true,
		columnShowhide: true,
		columnFilter: true,
		columnLock: false,
		fullGrid: false,

	});

	$('#fimgShow').click(function () {
		console.log('aaa');
		window.open($(this).attr("src"));
	});

	function get_customer_designdocuments_selectedKey() {
		var selected = $("#customer_check_list").find('tr.datagrid-selected-tr');
		var selectedKey = "";
		selected.each(function (index, item) {
			selectedKey += item.lastChild.innerText + ",";
			console.log(item.lastChild.innerText);
		});
		selectedKey = selectedKey.substring(0, selectedKey.length - 1);
		return selectedKey;
	}

	function customer_designdocuments_audit(type) {
		var resetKeys = get_customer_designdocuments_selectedKey();
		if (resetKeys.length > 0) {
			$.ajax({
				url: '/v1/customer/customer_editfiletype?ids=' + resetKeys + '&type=' + type,
				dataType: 'json',
				type: 'POST',
				xhrFields: {
					withCredentials: true
				},
				crossDomain: true,
				success: function (d) {
					if (d.state == 200) {
						$("body").alertmsg('info', '操作成功');
						$('#customer_check_list').datagrid('refresh');
					} else {
						$("body").alertmsg('info', '操作失败');
					}

				}
			});
		} else {
			$("body").alertmsg('error', '请选择要操作的对象。');
		}
	}


	function customer_designdocuments_changeValue(num) {
		setTimeout(function () {
			if (num == 0) {
				$('#customer_check_list').datagrid('refresh');
			} else {
				$('#customer_checked_list').datagrid('refresh');
			}
		}, 300);
	}

</script>

<div class="bjui-pageContent" style="height: 100%">
	<ul class="nav nav-tabs" role="tablist" id="customer_design_menuTab">
		<li class="active">
			<a style="font-size: 13px" href="#customer_check_images" role="tab" data-toggle="tab"
			   onclick="customer_designdocuments_changeValue(0)">待审图片</a>
		</li>
		<li>
			<a style="font-size: 13px" href="CustomerManagement/customer_check_drawings_1.html" role="tab"
			   data-toggle="ajaxtab" data-target="#customer_checked_images" data-reload="false"
			   onclick="customer_designdocuments_changeValue(1)">已审图片</a>
		</li>
	</ul>
	<div class="tab-content"  style="height: 95%">

		<div class="tab-pane fade active in" id="customer_check_images" style="height: 100%;">
			<div style="margin-bottom:10px;">
				<button type="button" class="btn btn-green" data-icon="thumbs-up" class="btn-default"
						onclick="customer_designdocuments_audit(true)">审核
				</button>
				<button type="button" class="btn btn-orange" data-icon="thumbs-down" class="btn-default"
						onclick="customer_designdocuments_audit(false)">驳回
				</button>
			</div>
			<table id="customer_check_list" class="table table-hover" data-width="100%"></table>
		</div>

		<div class="tab-pane fade" id="customer_checked_images" style="height: 100%;">

		</div>
	</div>
</div>