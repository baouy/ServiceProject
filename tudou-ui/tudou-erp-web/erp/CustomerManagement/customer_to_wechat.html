<!DOCTYPE html>
<html lang="en">
<head>
    <script type="text/javascript">
        $("#customer_wechat").datagrid({
            local: 'remote',
            dataUrl: '/v1/user/saleslist?type=3', //3是微聊
            dataType: 'json',
            sortAll: false,
            loadType: 'get',
            filterAll: true,
			height:'95%',
            columns: [
                {name: 'userlevel', width: '150', label: '等级'},
                {name: 'login_name', width: '150', label: '编码'},
                {name: 'flower_name', width: '150', label: '花名'},
                {name: 'username', width: '150', label: '姓名'},
                {name: 'follownum', width: '150', label: '在跟进数'},
                {name: 'orgname', width: '150', label: '部门'},
                {name: 'depname', width: '150', label: '组织'},
                {name: 'depcode', width: '150', label: '组织id',hide: true},
                {name: 'id', width: '80', label: '主键', hide: true}],
            paging: {pageSize: 50, selectPageSize: '50,100,200', pageCurrent: 1},
            columnMenu: true,
            columnShowhide: true,
            columnFilter: true,
            columnLock: false,
            fullGrid: false,
            dblOnClick: 'selected_wechat',

        });

        function selected_wechat(){
            var id,selected_customer_id,flower_name,depcode;

            selected_customer_id = $("#customer_wechat .datagrid-selected-tr>td:last-child").text(); //转电销列表中选中记录的id
            flower_name =  $("#customer_wechat .datagrid-selected-tr>td:eq(3)").text();//花名
            depcode = $("#customer_wechat .datagrid-selected-tr>td").last().prev().text();//部门id

            if (selected_customer_id == 0){
                $(this).alertmsg('error', '请在列表中选择要操作的对象。');
                return;
            }
            var c_e_title = $("#btn_list .active").children("a").text();
            if (c_e_title == "新客户") {
                id = customer_telephonesales_getselectedKey("customer_telephonesales"); //客户id
            } else if (c_e_title == "需跟进客户") {
                id = customer_telephonesales_getselectedKey("customer_telephonesales_1"); //客户id
            }

            $.ajax({
                url: '/v1/customer/customer_wechat',
                dataType: 'json',
                type: 'POST',
                data:{
                    id:selected_customer_id,
                    flower_name:flower_name,
                    ids:id,
                    depcode:depcode
                },
                xhrFields: {
                    withCredentials: true
                },
                crossDomain: true,
                success: function (d) {
                    if(d.state != 200){
                        $(this).alertmsg('error', '操作失败');
                        return;
                    }
                    if($("#btn_list .active").children("a").text()=="新客户") {
                        $('#customer_telephonesales').datagrid('refresh');
                        BJUI.dialog('closeCurrent',this);
                    }else if($("#btn_list .active").children("a").text()=="需跟进客户"){
                        $('#customer_telephonesales_1').datagrid('refresh');
                        BJUI.dialog('closeCurrent',this);
                    }
                }
            });
        }

    </script>
</head>
<body>
    <div class="bjui-pageContent">
        <form>
            <button type="button" class="btn btn-blue" data-icon="plus" onclick="selected_wechat()"><i class="fa fa-plus"></i>选择</button>
            <button type="button" class="btn-close btn" data-icon="close"><i class="fa fa-close"></i> 关闭</button>
            <table id="customer_wechat" class="table table-hover" data-width="100%" data-selected-multi="true">

            </table>
        </form>
    </div>
</body>
</html>