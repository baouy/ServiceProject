<!DOCTYPE html>
<html lang="en">
<head>
<script type="text/javascript">
    var custId;
    var select_enter = $(".navtab-tab .active").children("a").attr("title");//判断是哪个菜单列表进入的
    switch (select_enter) {
        case "客户档案(设计)":
            $("#customer_design_btn button").removeClass("hide");
            custId = $("#customer_designList").find('tr.datagrid-selected-tr')[0].lastChild.innerText;
            break;
        case "目标客户档案":
            custId = $("#customer_list_tabel").find('tr.datagrid-selected-tr')[0].lastChild.innerText;
            break;
        case "客户档案(电销)":
            if ($("#btn_list .active").children("a").text() == "需跟进客户") {
                custId = $("#customer_telephonesales_1").find('tr.datagrid-selected-tr')[0].lastChild.innerText;
            } else if ($("#btn_list .active").children("a").text() == "已转销售") {
                custId = $("#customer_telephonesales_2").find('tr.datagrid-selected-tr')[0].lastChild.innerText;
            } else if ($("#btn_list .active").children("a").text() == "回收池") {
                custId = $("#customer_telephonesales_3").find('tr.datagrid-selected-tr')[0].lastChild.innerText;
            } else if($("#btn_list .active").children("a").text() == "新客户"){
                custId = $("#customer_telephonesales").find('tr.datagrid-selected-tr')[0].lastChild.innerText;
            }
            break;
        case "客户档案(销售)":
            custId = $("#customer_sales").find('tr.datagrid-selected-tr')[0].lastChild.innerText;
            break;
        case "客户档案(销售)":
            custId = $("#customer_sales").find('tr.datagrid-selected-tr')[0].lastChild.innerText;
            break;
        case "成交跟进":
            custId = $("#complete_follow").find('tr.datagrid-selected-tr')[0].lastChild.innerText;
            break;
        default:
            break;
    }
    ;

    $('#customer_design_files').datagrid({
        local: 'remote',
        dataUrl: '/v1/customer/customer_designdocuments?custid_fk=' + custId,
        dataType: 'json',
        sortAll: false,
        loadType: 'get',
        filterAll: true,
		height:'95%',
        columns: [
            {name: 'state', width: '150', label: '状态'},
            {name: 'createtime', width: '150', label: '上传时间'},
            {name: 'createuser', width: '150', label: '上传人'},
            {name: 'style', width: '150', label: '风格'},
            {name: 'point', width: '150', label: '特点'},
            {name: 'details', width: '150', label: '备注'},
            {name: 'filename', width: '150', label: ' ',
                render:function(val) {
                    var img = val.split(",");
                    var str = '';
                    for (var i = 0; i < img.length; i ++){
                        var a = img[i]+'?imageView2/1/w/70/h/70/interlace/1/q/100';
                        str += '<img height="70" width="70" src=\"'+a + '\" >';
                    }
                    return str;
                }
            },
            {name: 'filename', width: '150', label: ' ',hide:true},
            {name: 'id', width: '80', label: '主键', hide: true}
        ],
        templateWidth: 600,
        showLinenumber: true,
        paging: {pageSize: 50, selectPageSize: '50,100,200', pageCurrent: 1},
        columnMenu: true,
        columnShowhide: true,
        columnFilter: true,
        columnLock: false,
        fullGrid: false,

    });



    function customer_design_deleteItems() {
        var deleteKeys = $('#customer_design_files').find('tr.datagrid-selected-tr');
        if (deleteKeys.length > 0) {
            $.ajax({
                url: '/v1/customer/customer_del_designdocuments?id='+deleteKeys[0].cells[8].innerText,
                dataType: 'json',
                type: 'DELETE',
                xhrFields: {
                    withCredentials: true
                },
                crossDomain: true,
                success: function (d) {
                    if (d.state == 200) {
                        $("body").alertmsg('info', '操作成功');
                        $('#customer_design_files').datagrid('refresh');
                    }
                }
            });
        }
        else {
            $("body").alertmsg('error', '请选择要操作的对象。')
        }
    }

    function designShowDetail(){
        var selected = $("#customer_design_files").find('tr.datagrid-selected-tr');
        if(selected.length == 0){
            $(this).alertmsg('error', '请在列表中选择要操作的对象。');
        }else {
            $(this).dialog({
                id:"customer_save_design",
                title:"设计文件跟进",
                url:"CustomerManagement/customer_design_edit.html",
                width:600,
                height:400,
                mask:true
            });
        }
    }

    function customer_put_designdocuments(){
        var selected = $("#customer_design_files").find('tr.datagrid-selected-tr');
        if(selected.length == 0){
            $(this).alertmsg('error', '请在列表中选择要操作的对象。');
        }else {
            $.ajax({
                url: '/v1/customer/customer_put_designdocuments?id='+selected[0].cells[8].innerText,
                dataType: 'json',
                type: 'POST',
                xhrFields: {
                    withCredentials: true
                },
                crossDomain: true,
                success: function (d) {
                    if (d.state == 200) {
                        $("body").alertmsg('info', '操作成功');
                        $('#customer_design_files').datagrid('refresh');
                    }
                }
            });
        }
    }

</script>
</head>
<body>
<div class="bjui-pageContent">
    <div style="margin:0px 0px 10px 0px;" id="customer_design_btn">
        <button type="button" class="btn btn-blue hide" data-icon="plus" data-url="CustomerManagement/customer_design_add.html" data-toggle="dialog" data-id="customer_add_design" data-mask="true" data-width="1050" data-height="600">新增</button>
        <button type="button" class="btn btn-green hide" data-icon="edit" onclick="designShowDetail()">查看</button>
        <button type="button" class="btn btn-green hide" data-icon="rocket" onclick="customer_put_designdocuments()">提交</button>

        <button type="button" class="btn btn-red hide" data-icon="times" onclick="customer_design_deleteItems()">删除</button>
        <!--<button type="button" class="btn-default hide" data-url="" data-mask="true" data-toggle="dialog" data-id="customer_submit_design" data-width="1050" data-height="400">提交</button>-->
        <!--<button type="button" class="btn-default hide" data-url="" data-mask="true" data-toggle="dialog" data-id="customer_upload_design" data-width="1050" data-height="400">上传照片</button>-->
    </div>
        <table class="table table-hover" data-width="100%" id="customer_design_files">
        </table>

</div>
</body>
</html>