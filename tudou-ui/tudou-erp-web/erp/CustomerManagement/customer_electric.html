<!DOCTYPE html>
<html>
	<head>
		<script type="text/javascript">
			$('#customer_telephonesales').datagrid({
				local: 'remote',
				dataUrl: '/v1/customer/customer_telephonesales?type=0',
				dataType: 'json',
				sortAll: false,
				loadType: 'get',
				filterAll: true,
				height:'95%',
				columns: [{
					name: 'customercode',
					width: '130',
					label: '编码'
				}, {
					name: 'cusname',
					width: '100',
					label: '姓名'
				}, {
					name: 'mobile',
					width: '100',
					label: '手机号'
				}, {
					name: 'community',
					width: '100',
					label: '小区名称'
				}, {
					name: 'source',
					width: '80',
					label: '来源'
				}, {
					name: 'secondsource',
					width: '90',
					label: '二级来源'
				}, {
					name: 'thirdsource',
					width: '90',
					label: '活动类型'
				}, {
					name: 'semsources',
					width: '60',
					label: 'sem来源'
				}, {
					name: 'semkeys',
					width: '100',
					label: 'sem关键词'
				}, {
					name: 'record',
					width: '200',
					label: '客户操作记录'
				},{
					name: 'custlevel',
					width: '50',
					label: '客户等级'
				}, {
					name: 'state',
					width: '90',
					label: '状态'
				}, {
					name: 'mobilesales',
					width: '90',
					label: '美聊员'
				}, {
					name:'wechat',
					width: '90',
					label: '微聊'
				}, {
					name: 'orgname',
					width: '90',
					label: '组织'
				},{
					name: 'createuser',
					width: '90',
					label: '创建人'
				},{
					name: 'createtime',
					width: '150',
					label: '创建时间'
				},{
					name: 'lastuser',
					width: '90',
					label: '最后修改人'
				},{
					name: 'lasttime',
					width: '150',
					label: '最后修改时间'
				}, {
					name: 'id',
					width: '80',
					label: '主键',
					hide: true
				}],
				paging: {
					pageSize: 50,
					selectPageSize: '50,100,200',
					pageCurrent: 1
				},
				columnMenu: true,
				columnShowhide: true,
				columnFilter: true,
				columnLock: false,
				fullGrid: false,
				dblOnClick: 'customer_to_edit1',

			});


			function customer_changeValue(num){
				setTimeout(function(){
					if(num == 0){
						$('#customer_telephonesales').datagrid('refresh');
					}else if(num == 1){
						$('#customer_telephonesales_1').datagrid('refresh');
					}else if(num == 2){
						$('#customer_telephonesales_2').datagrid('refresh');
					}else{
						$('#customer_telephonesales_3').datagrid('refresh');
					}
				},300);
			}

			function toElectric(name,tableId){
				var selected = customer_telephonesales_getselectedKey(tableId);
				if(selected.length == 0){
					$(this).alertmsg('error', '请在列表中选择要操作的对象。');
				}else {
					$(this).dialog({
						id:"customers_"+name,
						title:"转美聊",
						url:"CustomerManagement/customer_to_electric.html",
						width:1800,
						height:900,
						mask:true
					});
				}
			}

			function toWechat(name,tableId){
				var selected = customer_telephonesales_getselectedKey(tableId);
				if(selected.length == 0){
					$(this).alertmsg('error', '请在列表中选择要操作的对象。');
				}else {
					$(this).dialog({
						id:"customers_"+name,
						title:"微聊",
						url:"CustomerManagement/customer_to_wechat.html",
						width:1800,
						height:900,
						mask:true
					});
				}
			}
			function toSCustomermanager(name,tableId){
				var selected = customer_telephonesales_getselectedKey(tableId);
				if(selected.length == 0){
					$(this).alertmsg('error', '请在列表中选择要操作的对象。');
				}else {
					$(this).dialog({
						id:"customers_"+name,
						title:"转销售",
						url:"CustomerManagement/customer_to_sale.html",
						width:1800,
						height:900,
						mask:true
					});
				}
			}

			function customer_to_edit1() {
				var selected = $("#customer_telephonesales").find('tr.datagrid-selected-tr');
				if(selected.length == 0){
					$(this).alertmsg('error', '请在列表中选择要操作的对象。');
				}else {
					$(this).dialog({
						id:"customer_newCustomerFollow",
						title:"跟进",
						url:"CustomerManagement/customer_edit.html",
						width:1800,
						height:900,
						mask:true
					});
				}
			}

			function customer_to_edit2() {
				var selected = $("#customer_telephonesales_1").find('tr.datagrid-selected-tr');
				if(selected.length == 0){
					$(this).alertmsg('error', '请在列表中选择要操作的对象。');
				}else {
					$(this).dialog({
						id:"customer_needFollowCustomer",
						title:"跟进",
						url:"CustomerManagement/customer_edit.html",
						width:1800,
						height:900,
						mask:true
					});
				}
			}

			function customer_to_edit3() {
				var selected = $("#customer_telephonesales_2").find('tr.datagrid-selected-tr');
				if(selected.length == 0){
					$(this).alertmsg('error', '请在列表中选择要操作的对象。');
				}else {
					$(this).dialog({
						id:"customer_rePoolFollow",
						title:"跟进",
						url:"CustomerManagement/customer_edit.html",
						width:1800,
						height:900,
						mask:true
					});
				}
			}

			function customer_to_edit(dialogId, tableId) {
				var selected = $("#"+tableId).find('tr.datagrid-selected-tr');
				if(selected.length == 0){
					$(this).alertmsg('error', '请在列表中选择要操作的对象。');
				}else {
					$(this).dialog({
						id:"customer_"+dialogId,
						title:"跟进",
						url:"CustomerManagement/customer_edit.html",
						width:1800,
						height:900,
						mask:true
					});
				}
			}

			function customer_telephonesales_getselectedKey(tableId) {
				tableId = "#"+tableId;
				var selected = $(tableId).find('tr.datagrid-selected-tr');
				var selectedKey = "";
				selected.each(function (index, item) {
					selectedKey += item.lastChild.innerText + ",";
				});
				selectedKey = selectedKey.substring(0, selectedKey.length - 1);
				return selectedKey;
			}

			function customer_electric_table_getselectedKey() {
				var selected = $("#customer_telephonesales_3").find('tr.datagrid-selected-tr');
				var selectedKey = "";
				selected.each(function (index, item) {
					selectedKey += item.lastChild.innerText + ",";
				});
				selectedKey = selectedKey.substring(0, selectedKey.length - 1);
				return selectedKey;
			}

			function customer_electricity_make() {
				var selected = customer_electric_table_getselectedKey();
				if (selected.length == 0){
					$(this).alertmsg('error', '请选择要操作的对象。')
				}else{
					$.ajax({
						url: '/v1/customer/customer_electricity_make',
						dataType: 'json',
						type: 'POST',
						data:{
							ids:selected
						},
						xhrFields: {
							withCredentials: true
						},
						crossDomain: true,
						success: function (d) {
							if(d.state == 200){
								$(this).alertmsg('ok', '操作成功');
								$('#customer_telephonesales_3').datagrid('refresh');
							}else{
								$(this).alertmsg('info', '操作失败');
							}
						}
					});
				}
			}

			function show_t_download_alert() {
				$(this).alertmsg('confirm', '确定导出吗?', {okCall: 'telsales_download'});
			}

			function telsales_download(){
				var customercode = $("input[name='customercode']").val();
				var cusname = $("input[name='cusname']").val();
				var mobile = $("input[name='mobile']").val();
				var community = $("input[name='community']").val();
				var source = $("input[name='source']").val();
				var secondsource = $("input[name='secondsource']").val();
				var custlevel = $("input[name='custlevel']").val();
				var state = $("input[name='state']").val();
				var mobilesales = $("input[name='mobilesales']").val();
				var wechat = $("input[name='wechat']").val();
				var orgname = $("input[name='orgname']").val();
				var createuser = $("input[name='createuser']").val();
				var createtime = $("input[name='createtime']").val();
				var lastuser = $("input[name='lastuser']").val();
				var lasttime = $("input[name='lasttime']").val();

				var url="/v1/customer/customer_telephonesales_excel?pageCurrent=1&pageSize=10000";

				if(customercode.length > 0){
					url+="&customercode="+customercode;
				}
				if(cusname.length > 0){
					url+="&cusname="+cusname;
				}
				if(mobile.length > 0){
					url+="&mobile="+mobile;
				}
				if(community.length > 0){
					url+="&community="+community;
				}
				if(source.length > 0){
					url+="&source="+source;
				}
				if(secondsource.length > 0){
					url+="&secondsource="+secondsource;
				}
				if(custlevel.length > 0){
					url+="&custlevel="+custlevel;
				}
				if(state.length > 0){
					url+="&state="+state;
				}
				if(mobilesales.length > 0){
					url+="&mobilesales="+mobilesales;
				}
				if(wechat.length > 0){
					url+="&wechat="+wechat;
				}
				if(orgname.length > 0){
					url+="&orgname="+orgname;
				}
				if(createuser.length > 0){
					url+="&createuser="+createuser;
				}
				if(createtime.length > 0){
					url+="&createtime="+createtime;
				}
				if(lastuser.length > 0){
					url+="&lastuser="+lastuser;
				}
				if(lasttime.length > 0){
					url+="&lasttime="+lasttime;
				}

				window.open(url);
			}

		</script>
	</head>

	<body>
	<div class="bjui-pageContent" style="height: 100%">
		<ul class="nav nav-tabs" role="tablist" id="btn_list">
			<li class="active">
				<a style="font-size: 13px" href="#customer_new" role="tab" data-toggle="tab" onclick="customer_changeValue(0)">新客户</a>
			</li>
			<li>
				<a style="font-size: 13px" href="CustomerManagement/customer_electric_1.html" role="tab" data-toggle="ajaxtab" data-target="#customer_new_t" data-reload="false" onclick="customer_changeValue(1)">需跟进客户</a>
			</li>
			<li>
				<a style="font-size: 13px" href="CustomerManagement/customer_electric_2.html" role="tab" data-toggle="ajaxtab" data-target="#customer_new_x" data-reload="false" onclick="customer_changeValue(2)">已转销售</a>
			</li>
			<li>
				<a style="font-size: 13px" href="CustomerManagement/customer_electric_3.html" role="tab" data-toggle="ajaxtab" data-target="#customer_new_y" data-reload="false" onclick="customer_changeValue(3)">回收池</a>
			</li>
		</ul>

		<div class="tab-content" style="height: 95%">
			<!--新客户-->
			<div class="tab-pane fade active in" id="customer_new" style="height: 100%;">
				<div style="margin-bottom:10px;">
					<button type="button" class="btn btn-blue" data-icon="plus" data-url="CustomerManagement/customer_new.html"
							data-toggle="dialog" data-id="personnel_n" data-mask="true" data-width="1800" data-height="900"><i class="fa fa-plus"></i>新增
					</button>
					<button type="button" class="btn btn-green" data-icon="edit" onclick="customer_to_edit('newCustomerFollow','customer_telephonesales')"><i class="fa fa-edit"></i>跟进</button>
					<button type="button" class="btn btn-green" data-icon="user" onclick="toElectric('toElectric','customer_telephonesales')">转美聊</button>
					<button type="button" class="btn btn-green" data-icon="user" onclick="toWechat('towechat','customer_telephonesales')">转微聊</button>
					<button type="button" disabled="true" class="btn btn-green" data-icon="user" onclick="toSCustomermanager('toSCustomermanager','customer_telephonesales')"><i class="fa fa-user"></i> 转销售</button>
					<button type="button" class="btn btn-green" data-icon="sign-out" onclick="show_t_download_alert()"><i class="fa fa-sign-out"></i> 导出</button>
				</div>
				<table id="customer_telephonesales" class="table table-hover" data-width="100%"> </table>
			</div>

			<!--需跟进客户列表-->
			<div class="tab-pane fade" id="customer_new_t" style="height: 100%;">

			</div>

			<!--已转销售列表-->
			<div class="tab-pane fade" id="customer_new_x" style="height: 100%;">

			</div>

			<!--回收池-->
			<div class="tab-pane fade" id="customer_new_y" style="height: 100%;">

			</div>
		</div>
		</div>
	</body>

</html>