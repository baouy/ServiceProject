<script type="text/javascript">
	$('#customer_sales').datagrid({
		local: 'remote',
		dataUrl: '/v1/customer/customer_sales?type=0',
		dataType: 'json',
		sortAll: false,
		loadType: 'get',
		filterAll: true,
		height: '95%',
		columns: [{name: 'customercode', width: '130', label: '编码'},
			{name: 'cusname', width: '100', label: '姓名'},
			{name: 'mobile', width: '100', label: '手机号'},
			{name: 'cityname', width: '70', label: '城市'},
			{name: 'community', width: '100', label: '小区名称'},
			{name: 'firstamout', width: '90', label: '订金额'},
			{name: 'source', width: '70', label: '来源'},
			{name: 'followstate', width: '70', label: '跟进状态'},
			{name: 'followtype', width: '90', label: '跟进类型'},
			{name: 'tfappdate', width: '100', label: '预约日期'},
			{name: 'tfapptime', width: '100', label: '预约时间'},
			{name: 'createtime', width: '150', label: '最近回访时间'},
			{name: 'followdetails', width: '220', label: '最近回访内容'},
			{name: 'custsales', width: '90', label: '客户经理'},
			{name: 'mobilesales', width: '90', label: '美聊员'},
			{name: 'id', width: '80', label: '主键', hide: true}],
		paging: {
			pageSize: 50,
			selectPageSize: '50,100,200',
			pageCurrent: 1
		},
		columnMenu: true,
		columnShowhide: true,
		columnFilter: true,
		columnLock: false,
		fullGrid: false,
		dblOnClick: 'customer_sales_edit1',

	});

	function changeValue(num) {

		setTimeout(function () {
			if (num == 0) {
				$('#customer_sales').datagrid('refresh');
			} else if (num == 1) {
				$('#customer_sales_1').datagrid('refresh');
			} else if (num == 2) {
				$('#customer_sales_2').datagrid('refresh');
			} else {
				$('#customer_sales_3').datagrid('refresh');
			}
		}, 300);
	}

	function customer_sales_edit(dialogId, tableId) {
		var selected = $("#" + tableId).find('tr.datagrid-selected-tr');
		if (selected.length == 0) {
			$(this).alertmsg('error', '请在列表中选择要操作的对象。');
		} else {
			$(this).dialog({
				id: "customer_" + dialogId,
				title: "跟进",
				url: "CustomerManagement/customer_edit.html",
				width: 1800,
				height: 900,
				mask: true
			});
		}
	}

	function customer_sales_edit1() {
		var selected = $("#customer_sales").find('tr.datagrid-selected-tr');
		if (selected.length == 0) {
			$(this).alertmsg('error', '请在列表中选择要操作的对象。');
		} else {
			$(this).dialog({
				id: "customer_sales_edit",
				title: "跟进",
				url: "CustomerManagement/customer_edit.html",
				width: 1800,
				height: 900,
				mask: true
			});
		}
	}

	function customer_sales_edit2() {
		var selected = $("#customer_sales_2").find('tr.datagrid-selected-tr');
		if (selected.length == 0) {
			$(this).alertmsg('error', '请在列表中选择要操作的对象。');
		} else {
			$(this).dialog({
				id: "customer_customer_sales_edit2",
				title: "跟进",
				url: "CustomerManagement/customer_edit.html",
				width: 1800,
				height: 900,
				mask: true
			});
		}
	}

	function customer_sales_edit3() {
		var selected = $("#customer_sales_3").find('tr.datagrid-selected-tr');
		if (selected.length == 0) {
			$(this).alertmsg('error', '请在列表中选择要操作的对象。');
		} else {
			$(this).dialog({
				id: "customer_customer_sales_edit3",
				title: "跟进",
				url: "CustomerManagement/customer_edit.html",
				width: 1800,
				height: 900,
				mask: true
			});
		}
	}

	function change_three_type_value(name, tableId, url, title) {
		var selected = customer_sales_getselectedKey(tableId);
		if (selected.length == 0) {
			$(this).alertmsg('error', '请在列表中选择要操作的对象。');
		} else {
			$(this).dialog({
				id: "customers_" + name,
				title: title,
				url: "CustomerManagement/" + url,
				width: 1800,
				height: 900,
				mask: true
			});
		}
	}


	function customer_sales_getselectedKey(tableId) {
		tableId = "#" + tableId;
		var selected = $(tableId).find('tr.datagrid-selected-tr');
		var selectedKey = "";
		selected.each(function (index, item) {
			selectedKey += item.lastChild.innerText + ",";
		});
		selectedKey = selectedKey.substring(0, selectedKey.length - 1);
		return selectedKey;
	}


</script>
<div class="bjui-pageContent" style="height: 100%">
	<ul class="nav nav-tabs" role="tablist" id="customer_sale_menuTab">
		<li class="active">
			<a style="font-size: 13px" href="#customer_sale_new" role="tab" data-toggle="tab" onclick="changeValue(0)">销售跟进</a>
		</li>
		<li>
			<a style="font-size: 13px" href="CustomerManagement/customer_netsale_table_1.html" role="tab" data-toggle="ajaxtab" data-target="#customer_sale_new_t" data-reload="false"
			   onclick="changeValue(1)">转设计</a>
		</li>
		<li>
			<a style="font-size: 13px" href="CustomerManagement/customer_netsale_table_2.html" role="tab" data-toggle="ajaxtab" data-target="#customer_sale_new_x" data-reload="false"
			   onclick="changeValue(2)">已成交</a>
		</li>
		<li>
			<a style="font-size: 13px" href="CustomerManagement/customer_netsale_table_3.html" role="tab" data-toggle="ajaxtab" data-target="#customer_sale_new_y" data-reload="false"
			   onclick="changeValue(3)">回收池</a>
		</li>
	</ul>

	<div class="tab-content" style="height: 95%">
		<div class="tab-pane fade active in" id="customer_sale_new" style="height: 100%;">
			<div style="margin-bottom:10px;">
				<button type="button" class="btn btn-blue" data-icon="plus"
						data-url="CustomerManagement/customer_new.html" data-width="1800" data-height="900"
						data-toggle="dialog" data-id="customer_sale_add" data-mask="true"><i class="fa fa-plus"></i>新增
				</button>

				<button type="button" class="btn btn-green" data-icon="edit"
						onclick="customer_sales_edit('customer_sales_edit','customer_sales')"><i class="fa fa-edit"></i>跟进
				</button>

				<button type="button" class="btn btn-green" data-icon="user"
						onclick="change_three_type_value('change_customer_sales','customer_sales','customer_to_electric.html','转美聊')">
					转美销
				</button>

				<button type="button" class="btn btn-green" data-icon="user"
						onclick="change_three_type_value('change_customer_sales_1','customer_sales','customer_to_sale.html','转销售')">
					转销售
				</button>

				<button type="button" class="btn btn-green" data-icon="user"
						onclick="change_three_type_value('change_customer_sales_2','customer_sales','customer_to_design.html','转设计')">
					转设计
				</button>

			</div>
			<table id="customer_sales" class="table table-hover" data-width="100%"></table>
		</div>

		<div class="tab-pane fade" id="customer_sale_new_t" style="height: 100%;">

		</div>

		<div class="tab-pane fade" id="customer_sale_new_x" style="height: 100%;">

		</div>

		<div class="tab-pane fade" id="customer_sale_new_y" style="height: 100%;">

		</div>

	</div>
</div>