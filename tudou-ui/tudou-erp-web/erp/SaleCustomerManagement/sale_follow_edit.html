<script>

	var user_id = $.cookie("id");
	if (user_id != sale_id){
		$("#save_sale_btn").attr("class","hide");
	}

	/**
	 * 保存后返回数据
	 */
	$.ajax({
		url: '/v1/newcustomer/customerdatail?cid=' + s_c_id,
		dataType: 'json',
		type: 'GET',
		xhrFields: {
			withCredentials: true
		},
		crossDomain: true,
		success: function (d) {
			if(d.state == 200){
				var followdata = d.data.newtfollowrecords;
				for (var i in d.data) {
					$("#customer_" + i).val(d.data[i]);//将用到的数据渲染到页面中
					if (i == "budget"){
						$("#customer_" + i).selectpicker('val', d.data[i]);
					}else if (i == "roommodel"){
						$("#customer_" + i).selectpicker('val', d.data[i]);
					}else if (i == "marktime"){
                        $("#customer_" + i).selectpicker('val', d.data[i]);
                    }
					/*else if (i == "marketactive"){ //暂取消
					 if (d.data[i] == '其他'){
					 $("#time_a").removeAttr("class");
					 $("#customer_marktime").removeAttr("novalidate");
					 $("#customer_marktime").attr("data-rule","required;datetime");
					 }
					 $("#customer_" + i).selectpicker('val', d.data[i]);

					 }*/else if (i == "source"){
						$("#customer_" + i).val(d.data[i]);
					}else if (i == "intentiontype"){
						$("#customer_" + i).selectpicker('val', d.data[i]);
					}else if (i == "newtcustomerside"){
						for (var a in d.data.newtcustomerside){
							$("#customer_" + a).val(d.data.newtcustomerside[a]);
							if(a == "newbudget"){
								$("#customer_" + a).selectpicker('val', d.data.newtcustomerside[a]);
							}
						}
					}else if (i == "newtfollowrecords"){
					    var x = d.data.newtfollowrecords.length;
						$("#customer_follownum").html('X'+x);

                        for (var n = 0; n < x; n ++){
                                $("#customer_" + n + "_time").html('第'+(n+1)+'次跟进 '+ d.data.newtfollowrecords[n].createtime);
                                continue
                            }
					}else if (i == "completion"){
						$("#customer_" + i).html(d.data[i]);
					}else if (i == "otherdetail"){
						if (d.data[i] == null || d.data[i].length == 0){
							KindEditor.html("#customer_" + i,'<ol><li><p class="MsoListParagraph"><span>&nbsp;&nbsp;</span><span>家庭成员</span></p><p class="MsoListParagraphCxSpFirst">成员：<span></span></p><p class="MsoListParagraphCxSpMiddle">客户年龄：<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>性别：男<span>/</span>女<span></span></p><p class="MsoListParagraphCxSpMiddle">职业：<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>谁做主：<span></span></p><p class="MsoListParagraphCxSpLast">兴趣爱好：</p></li><li><p class="MsoListParagraphCxSpLast"><span>&nbsp;&nbsp;</span><span>预算</span></p><p class="MsoListParagraph">中央空调<span>&nbsp;&nbsp;</span>地暖</p><p><br/></p></li><li><p class="MsoListParagraph"><span>&nbsp;&nbsp;</span><span>用途</span></p><p class="MsoListParagraph">自主<span>/</span>出租<span>/</span>给老人</p><p><br/></p></li><li><p class="MsoListParagraph"><span>产品匹配</span></p><p class="MsoListParagraphCxSpFirst">实测<span>/0.75&nbsp;&nbsp;</span>税金<span>3.14%&nbsp;&nbsp;</span>远程费<span>&nbsp;&nbsp;&nbsp;</span>完整商品<span></span></p><p class="MsoListParagraphCxSpLast">个性包：</p><p><br/></p></li><li><p class="MsoListParagraphCxSpLast"><span>装修经验</span></p><p class="MsoListParagraph">首套<span>/</span>非首套（以前怎么装修：<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>）</p><p><br/></p></li><li><p class="MsoListParagraph"><span>&nbsp;</span><span>关注偏好</span></p><p class="MsoListParagraphCxSpFirst">环保<span>&nbsp;&nbsp;&nbsp;</span>施工质量<span>&nbsp;&nbsp;&nbsp;</span>设计<span>&nbsp;&nbsp;&nbsp;</span>自有工人<span>&nbsp;&nbsp;&nbsp;</span>工期<span>&nbsp;&nbsp;</span>服务<span>&nbsp;</span>吊顶<span></span></p><p class="MsoListParagraphCxSpLast">套餐和个性包之外的产品</p><p><br/></p></li><li><p class="MsoListParagraphCxSpLast"><span>&nbsp;</span><span>服务模式（是否聊到）</span></p><p class="MsoListParagraph">先交定后量房<span>&nbsp;&nbsp;</span>客户经理制</p><p><br/></p></li><li><p class="MsoListParagraph"><span>&nbsp;</span><span>性格匹配</span></p><p class="MsoListParagraphCxSpFirst">客户性格：老虎（控制）<span>&nbsp;&nbsp;</span>孔雀（表现）<span>&nbsp;&nbsp;&nbsp;</span>猫头鹰（分析）<span></span></p><p class="MsoListParagraphCxSpMiddle">考拉（随和）<span></span></p><p class="MsoListParagraphCxSpMiddle">客户经理偏好：男<span>/</span>女<span></span></p><p class="MsoListParagraphCxSpLast">客户经理类型：活泼<span>/</span>理智<span>/</span>热情<span>/</span>成熟<span>/</span>服务</p><p><br/></p></li><li><p class="MsoListParagraphCxSpLast"><span>&nbsp;</span><span>潜在对手</span></p><p class="MsoListParagraph">熟人：<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>其他：</p><p><br/></p></li><li><p class="MsoListParagraph"><span>&nbsp;</span><span>乘坐交通工具（明天怎么来，如果开车的话，给您预约车位，给个提醒，坐公交地铁什么的）：</span></p><p><br/></p></li></ol>');
						}else{
							KindEditor.html("#customer_" + i, d.data[i]);
						}
					}else if (i == "roommodeldeatil"){
						var rd = d.data[i] == null?'':d.data[i];
						if (rd.length > 0){
							$("#room_a").removeAttr("class");
						}
					}else if (i == "intentiontypedeatil"){
						var itd = d.data[i] == null?'':d.data[i];
						if (itd.length > 0){
							$("#intent_a").removeAttr("class");
						}
					}else if (i == "giveup"){
						if (d.data[i]){
							$("#customer_" + i +"_ts").iCheck('check');
						}else{
							$("#customer_" + i +"_ts").iCheck('uncheck');
						}
					}
				}
			}else{
				$(this).alertmsg('warn', '获取失败,请刷新');
			}
		}
	});

	function saveCalback(json) {
		if (json.state == 200) { //保存成功
			BJUI.dialog('closeCurrent', this);
            sales_tab_refresh();
            //sales_fllows_refresh();
			$(this).alertmsg('ok', '保存成功');
		} else {
			$(this).alertmsg('warn', json.content);
		}
	}

	function sale_save_onclick() {
        /*if ($("#customer_markid").val()=="") {
            $("#customer_markid").val('0')
        }
        if ($("#customer_marktime").val()=="") {
            $("#customer_marktime").val('0000-00-00 00:00:00')
        }*/
		$('#customer_info').submit()
	}

	/*var sale_select_index,sale_datas;
	$("#customer_marketactive").change(function() {
		var mt = $('#customer_marketactive option:selected').val()
		sale_select_index = $('#customer_marketactive').get(0).selectedIndex

		if (mt == '其他' || sale_select_index == 0){
			$("#customer_markid").val('0')
			$("#customer_marktime").val('')
			if (sale_select_index != 0){
				$("#time_a").removeAttr("class");
				$("#customer_marktime").removeAttr("novalidate");
				$("#customer_marktime").attr("data-rule","required;datetime");
			}else{
				$("#customer_marktime").val('0000-00-00 00:00:00')
				$("#time_a").attr("class","hide");
				$("#customer_marktime").attr("novalidate","");
				$("#customer_marktime").attr("class","form-control");
			}
		}else{
			$("#time_a").attr("class","hide");
			$("#customer_markid").val(sale_datas[sale_select_index - 1].id)
			$("#customer_marktime").val(sale_datas[sale_select_index - 1].activetime)
			$("#customer_marktime").attr("novalidate","");
			$("#customer_marktime").attr("class","form-control");

		}
	});*/


	$("#customer_roommodel").change(function() {
		var mt = $('#customer_roommodel option:selected').val()
		if (mt == '其他'){
			$("#room_a").removeAttr("class");
		}else{
			$("#room_a").attr("class","hide");
		}
	});

	$("#customer_intentiontype").change(function() {
		var mt = $('#customer_intentiontype option:selected').val()
		if (mt == '非意向(其他)'){
			$("#intent_a").removeAttr("class");
		}else{
			$("#intent_a").attr("class","hide");
		}
	});

	$('#customer_giveup_ts').on('ifChanged', function(event){
		$('#customer_giveup').val($(this).is(':checked'));
		if ($(this).is(':checked')){
			$("#customer_nextfellowtime").attr("novalidate","");
			$("#customer_nextfellowtime").attr("class","form-control");
			$("#customer_nextfellowtime").val("");
			$("#td_b").attr("class","hide");
		}else{
			$("#customer_nextfellowtime").removeAttr("novalidate");
			$("#customer_nextfellowtime").attr("data-rule","required;datetime");
			$("#td_b").removeAttr("class");
		}
	});


	$("#customer_nextfellowtime").change(function () {
		var d2 = new Date($("#customer_nextfellowtime").val());
		if (d2 < d) {

		}
	});

	/*$.ajax({
				type: "get",
				dataType: "json",
				contentType: "application/json;charset=utf-8",
				url: '/v1/activity/activitylist',
				success: function (d) {
                    sale_datas = d.data
					$("#customer_marketactive").append("<option value=''>请选择</option>");
					for (var i = 0; i < d.data.length; i++) {
						var value = d.data[i];
						$("#customer_marketactive").append("<option value='" + value.activename + "'>" + value.activename + "</option>");
					}
					$("#customer_marketactive").append("<option value='其他'>其他</option>");
				},
				error: function (XMLHttpRequest, textStatus, errorThrown) {
					alert(errorThrown);
				},
				async: false
			}
	);*/

</script>

<div style="height: 100%;width: 100%">

	<div style="height: 50px; padding-top: 16px">
		<label class="control-label" style="font-size:18px;">添加客户</label>

		<label class="control-label" style="font-size:18px;">跟进次数</label>
		<label class="control-label" style="font-size:18px;" id="customer_follownum"></label>

		<label class="control-label" style="font-size:18px;">完成率</label>
		<label class="control-label" style="font-size:18px;color: #cc0000" id="customer_completion"></label>
	</div>

	<form action="/v1/newcustomer/update" id="customer_info" data-toggle="validate" data-callback="saveCalback"
		  style="width:100%;height: 100%;">
		<div class="roleLeft"
			 style="border: 0px solid green;width: 50% !important;position: relative;height: 85%;float: left;">

			<input type="hidden" value="" id="customer_id" name="id">
			<input type="hidden" value="" id="customer_giveup" name="giveup">
			<input type="hidden" value="" id="customer_markid" name="markid">

			<div class="bjui-pageContent" style="height: 100%;">
				<table class="table table-condensed table-hover">
					<tbody>
					<tr style="height: 40px;background-color:#D0D0D0">
						<td><label class="control-label" style="font-size:18px;">9必</label></td>
					</tr>
					<tr style="height: 38px">
						<td>
							<label class="control-label x130" style="font-size:18px;">姓名</label>
							<input type="text" id="customer_cusname" name="cusname" value="" size="15"
								   style="margin-left: 50px;">
							<label id="customer_0_time" class="control-label x200" style="font-size:8px;"></label>
						</td>
					</tr>

					<tr style="height: 38px">
						<td>
							<label class="control-label x130" style="font-size:18px;">电话(必填)</label>
							<input type="text" id="customer_mobile" name="mobile" value="" size="15"
								   style="margin-left: 50px;" data-rule="required;mobile" readonly="true">
							<label id="customer_1_time" class="control-label x200" style="font-size:8px;"></label>
						</td>
					</tr>
					<tr style="height: 38px">
						<td>
							<label class="control-label x130" style="font-size:18px;">小区</label>
							<input type="text" id="customer_village" name="village" value="" size="15"
								   style="margin-left: 50px;">
							<label id="customer_2_time" class="control-label x200" style="font-size:8px;"></label>
						</td>
					</tr>
					<tr style="height: 38px">
						<td>
							<label class="control-label x130" style="font-size:18px;">面积</label>
							<input type="text" id="customer_area" name="area" value="" size="15"
								   style="margin-left: 50px;" data-rule="number">
							<label id="customer_3_time" class="control-label x200" style="font-size:8px;"></label>
						</td>
					</tr>
					<tr style="height: 38px">
						<td>
							<label class="control-label x130" style="font-size:18px;">交房时间</label>
							<input type="text" id="customer_handoverdate" value="" size="15" name="handoverdate"
								   data-toggle="datepicker" data-rule="date" data-pattern="yyyy-MM-dd" style="margin-left: 50px;">
							<label id="customer_4_time" class="control-label x200" style="font-size:8px;"></label>
						</td>
					</tr>
					<tr style="height: 38px">
						<td>
							<label class="control-label x130" style="font-size:18px;">预算</label>
							<a style="margin-left: 50px;"></a>
							<select data-toggle="selectpicker" id="customer_newbudget" name="newbudget" data-width="70">
								<option value="">请选择</option>
								<option value="7万以下">7万以下</option>
								<option value="7万">7万</option>
								<option value="8万">8万</option>
								<option value="9万">9万</option>
								<option value="10万">10万</option>
								<option value="11万">11万</option>
								<option value="12万">12万</option>
								<option value="13万">13万</option>
								<option value="14万">14万</option>
								<option value="15万">15万</option>
								<option value="15万以上">15万以上</option>
							</select>
							<label id="customer_5_time" class="control-label x200" style="font-size:8px;"></label>
						</td>
					</tr>
					<tr style="height: 38px">
						<td>
							<label class="control-label x130" style="font-size:18px;">毛坯平层</label>
							<a style="margin-left: 50px;"></a>
							<select data-toggle="selectpicker" id="customer_roommodel" name="roommodel" data-width="70">
								<option value="">请选择</option>
								<option value="毛坯平层">毛坯平层</option>
								<option value="旧房平层">旧房平层</option>
								<option value="复式毛坯">复式毛坯</option>
								<option value="跃层毛坯">跃层毛坯</option>
								<option value="排屋毛坯">排屋毛坯</option>
								<option value="别墅毛坯">别墅毛坯</option>
								<option value="其他">其他</option>
							</select>
							<a id="room_a" class="hide"><input type="text" id="customer_roommodeldeatil" name="roommodeldeatil" value="" size="15"
								   style="margin-left: 10px;"></a>
							<label id="customer_6_time" class="control-label x200" style="font-size:8px;"></label>
						</td>
					</tr>
					<!-- 不可编辑， 收款单（类型为预售） 审核时反写此字段值到客户表-->
					<tr style="height: 38px">
						<td>
							<label class="control-label x130" style="font-size:18px;">预售情况</label>
							<input type="text" id="customer_bookingsituation" name="bookingsituation" value="" size="15"
								   style="margin-left: 50px;" readonly="true">
							<label id="customer_7_time" class="control-label x200" style="font-size:8px;"></label>
						</td>
					</tr>
					<tr style="height: 38px">
						<td>
							<label class="control-label x130" style="font-size:18px;">邀约</label>
							<a style="margin-left: 50px;"></a>
							<!--<select data-toggle="selectpicker" id="customer_marketactive" name="marketactive"
									data-width="70">
							</select>
							<a id="time_a" class="hide"><input type="text" name="marktime" id="customer_marktime" value=""
															   data-toggle="datepicker" data-pattern="yyyy-MM-dd HH:mm:ss" size="15"></a>-->
							<!--<input class="hide" id="customer_marketactive" name="marketactive" value="其他"> </input>-->
							<input type="text" name="marktime" id="customer_marktime" value="" data-toggle="datepicker" data-pattern="yyyy-MM-dd HH:mm:ss" data-min-date="{%y}-%M-%d" size="15" >
							<label id="customer_8_time" class="control-label x200" style="font-size:8px;"></label>
						</td>
					</tr>
					<tr>
						<td style="height: 40px;background-color:#D0D0D0">
							<label class="control-label" style="font-size:18px;">结果</label>
						</td>
					</tr>
					<tr style="height: 38px">
						<td colspan="4">
							<label class="control-label x130" style="font-size: 17px;">来源(必填)：</label>
							<input type="text" id="customer_source" name="source" value="" size="8"
								   style="margin-left: 50px;" readonly="true">
							<input type="text" id="customer_record" value="" size="30"
								   style="margin-left: 20px;font-size: 8px;" readonly="true">
						</td>
					</tr>

					<tr style="height: 38px">
						<td colspan="4">
							<label class="control-label x130" style="font-size: 17px;">是否意向客户(必填)：</label>
							<a style="margin-left: 50px;"></a>
							<select data-toggle="selectpicker" id="customer_intentiontype" name="Intentiontype"
									data-width="170" data-rule="required">
								<option value="">请选择</option>
								<option value="意向客户">意向客户</option>
								<option value="非意向(无人接听/关机)">非意向(无人接听/关机)</option>
								<option value="非意向(随便注册)">非意向(随便注册)</option>
								<option value="非意向(直接挂断)">非意向(直接挂断)</option>
								<option value="非意向(本市非服务范围内)">非意向(本市非服务范围内)</option>
								<option value="非意向(外地)">非意向(外地)</option>
								<option value="非意向(不足70㎡)">非意向(不足70㎡)</option>
								<option value="非意向(房子已装修好)">非意向(房子已装修好)</option>
								<option value="非意向(房子太旧)">非意向(房子太旧)</option>
								<option value="非意向(大于180㎡)">非意向(大于180㎡)</option>
								<option value="非意向(户型不符)">非意向(户型不符)</option>
								<option value="非意向(其他)">非意向(其他)</option>
							</select>
							<a id="intent_a" class="hide"><input type="text" id="customer_intentiontypedeatil" name="intentiontypedeatil" value=""
								   size="15" style="margin-left: 10px;"></a>
							<a style="margin-left: 20px"><input type="checkbox" id="customer_giveup_ts" data-toggle="icheck"  value="true" data-label="放弃该客户"></a>
						</td>
					</tr>

					<tr style="height: 60px">
						<td>
							<label class="control-label x130" style="font-size: 18px;">备注(500字)：</label>
							<a style="margin-left: 50px;"></a>
							<textarea id="customer_details" name="details" data-toggle="autoheight" cols="65" data-width="100%"
									  rows="2" maxlength="500"></textarea>
						</td>
					</tr>
					<tr>
						<td id="td_b">
							<label class="control-label x130" style="font-size:18px;">下次跟进时间(必填)</label>
							<a style="margin-left: 50px;"></a>
							<a><input type="text" name="nextfellowtime" id="customer_nextfellowtime" value="" data-toggle="datepicker" data-pattern="yyyy-MM-dd HH:mm:ss" size="15" data-rule="required;datetime"></a>
						</td>
					</tr>

					</tbody>
				</table>
			</div>

		</div>

		<div class="roleRight"
			 style="border: 0px solid green;width: 50% !important;position: relative;height: 85.5%;float: left;">
			<div id="customer_adddiv" class="bjui-pageContent" style="margin-left: 1px;">

				<div style="height: 40px;background-color:#D0D0D0">
					<label class="control-label" style="font-size:18px;margin-top: 11px;">其他信息</label>
				</div>

				<textarea name="otherdetail" id="customer_otherdetail" class="j-content" data-toggle="kindeditor" data-width="100%" data-height="675px">

				</textarea>
			</div>
		</div>

	</form>

</div>

<div class="bjui-pageFooter">
	<ul>
		<li>
			<button type="button" class="btn-close" data-icon="close">取消</button>
		</li>
		<li>
			<button type="button" class="btn-default" data-icon="save" onclick="sale_save_onclick()" id="save_sale_btn">保存</button>
		</li>
	</ul>
</div>