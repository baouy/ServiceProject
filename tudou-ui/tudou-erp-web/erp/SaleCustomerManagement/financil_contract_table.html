<script type="text/javascript">

    //var roleid = $.cookie("roleid");
    var tab_contract_selected_row, tab_contract_selected_id = -1;

    $('#tab_contract_list_datagrid').datagrid({

        local: 'remote',
        dataUrl: '/v1/contract/customer_contractlist?custid_fk='+s_c_id,
        dataType: 'json',
        sortAll: false,
        loadType: 'get',
        filterAll: true,
        height: '90%',
        columns: [{name: 'contractdoc', width: '110', label: '合同单号'},
            {name: 'custname', width: '70', label: '姓名'},
            {name: 'mobile', width: '100', label: '手机号'},
            {name: 'community', width: '100', label: '小区名'},
            {name: 'state', width: '50', label: '状态',type:'select',items:[{'新增':'新增','审核':'审核'}]},
            {name: 'room', width: '70', label: '门牌号'},
            {name: 'rooms', width: '30', label: '室',type:'select',items: [{'0': '0室'},{'1': '1室'},{'2': '2室'},{'3': '3室'},{'4': '4室'},{'5': '5室'}],render:function(value){
                return value==""?"":value+"室";
            }},
            {name: 'hall', width: '30', label: '厅',type:'select',items: [{'0': '0厅'},{'1': '1厅'},{'2': '2厅'},{'3': '3厅'},{'4': '4厅'},{'5': '5厅'}],render:function(value){
                return value==""?"":value+"厅";
            }},
            {name: 'kitchen', width: '30', label: '厨',type:'select',items: [{'0': '0厨'},{'1': '1厨'},{'2': '2厨'},{'3': '3厨'},{'4': '4厨'},{'5': '5厨'}],render:function(value){
                return value==""?"":value+"厨";
            }},
            {name: 'toilet', width: '30',label: '卫',type:'select',items: [{'0': '0卫'},{'1': '1卫'},{'2': '2卫'},{'3': '3卫'},{'4': '4卫'},{'5': '5卫'}],render:function(value){
                return value==""?"":value+"卫";
            }},
            {name: 'balcony', width: '40', label: '阳台',type:'select',items: [{'0': '0阳台'},{'1': '1阳台'},{'2': '2阳台'},{'3': '3阳台'},{'4': '4阳台'},{'5': '5阳台'}],render:function(value){
                return value==""?"":value+"阳台";
            }},
            {name: 'usearea', width: '70', label: '量房面积'},
            {name: 'buildarea', width: '70', label: '产权面积'},
            {name: 'handoverdate', width: '70', label: '交房时间',type:'date',pattern:'yyyy-MM-dd'},
            {name: 'roomtype', width: '70', label: '房屋类型',type:'select',items:[{'毛坯平层':'毛坯平层'},{'旧房平层':'旧房平层'},{'复式毛坯':'复式毛坯'},{'跃层毛坯':'跃层毛坯'},{'排屋毛坯':'排屋毛坯'},{'别墅毛坯':'别墅毛坯'},{'其他':'其他'}]},
            {name: 'paid', width: '70', label: '已付总额',columnFilter:false},
            {name: 'paypercent', width: '70', label: '已付百分比',render:function(value){
                return value ? value+"%": value;
            }},
            {name: 'contractamount', width: '70', label: '合同总额'},
            {name: 'standardcost', width: '70', label: '基本造价'},
            {name: 'personalpkg', width: '70', label: '个性化造价'},
            {name: 'taxes', width: '70', label: '税金'},
            {name: 'servicecost', width: '70', label: '远程费'},
            {name: 'personchange', width: '70', label: '个性化变动'},
            {name: 'preferential', width: '70', label: '优惠金额'},
            {name: 'preferentialinfo', width: '70', label: '优惠信息'},
            //{name: 'ispay', width: '50', type: 'select', label: '是否收款', items: [{'true': '是'}, {'false': '否'}]},
            {name: 'createuser', width: '70', label: '制单人'},
            {name: 'createtime', width: '100', label: '制单时间',type:'date',pattern:'yyyy-MM-dd',render:function(value){
                return value ? value.substr(0, 18) : value;
            }},
            {name: 'reviewuser', width: '70', label: '审核人'},
            {name: 'reviewtime', width: '100', label: '审核时间',type:'date',pattern:'yyyy-MM-dd'},
            {name: 'id', width: '80', label: '', hide: true}
        ],
        paging: {pageSize: 20, selectPageSize: '50,100,200', pageCurrent: 1},
        columnMenu: true,
        columnShowhide: true,
        columnFilter: true,
        columnLock: false,
        fullGrid: false,
        dblOnClick: 'contract_dbClick',
        showToolbar: true,
        toolbarCustom: '<button type="button" class="btn btn-green" data-icon="edit" onclick="contract_dbClick()">编辑</button></form>'
    });

    function contract_dbClick() {
        tab_contract_selected_row = $("#tab_contract_list_datagrid").data('selectedDatas');
        if (null == tab_contract_selected_row || tab_contract_selected_row.length == 0) {
            $(this).alertmsg('error', '请在列表中选择要操作的对象。');
        } else if (tab_contract_selected_row.length > 1) {
            $(this).alertmsg('error', '请选择唯一的操作对象。');
        } else {
            if(tab_contract_selected_row[0].stateid==51){
                $(this).alertmsg('error', '合同已经审核不能编辑');
                return;
            }
            tab_contract_selected_id = tab_contract_selected_row[0].id;
            if (tab_contract_selected_id > 0) {
                $(this).dialog({
                    id: 'engineering_project_edit',
                    url: 'SaleCustomerManagement/financil_contract_edit.html',
                    title: '编辑合同',
                    width: '1050',
                    height: '350',
                    mask: true
                });
            }
        }
    }

    function btn_chooseItems_setting(val) {
        if (val == 51) {
            $('#tab_contract_save_btn').attr('disabled', "true");
        } else {
            $('#tab_contract_save_btn').removeAttr("disabled");
        }
    }

    function contract_edit_back(json) {
        if (json.state == 200) {
            BJUI.dialog('closeCurrent', this);
            // sales_fllows_refresh();
            $('#tab_contract_list_datagrid').datagrid('refresh');
        } else {
            $(this).alertmsg('error', json.content);
        }
    }
</script>
<table id="tab_contract_list_datagrid" class="table table-hover" data-width="100%" data-height="100%"></table>