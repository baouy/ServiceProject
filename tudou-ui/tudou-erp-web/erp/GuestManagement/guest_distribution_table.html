<script>
		$('#guest_distribution_table').datagrid({
			local: 'remote',
			dataUrl: '/v1/user/distribution?statelist='+[1,19],
			dataType: 'json',
			sortAll: false,
			loadType: 'get',
			filterAll: true,
			height:'95%',
			columns:
					[
						{name: 'flower_name', width: '150', label: '员工姓名'},
						{name: 'maxnum', width: '100', label: '当前客户数'},
                        {name: 'depname', width: '100', label: '部门'},
					],
			paging: {pageSize: 50, selectPageSize: '50,100,200', pageCurrent: 1},
			hiddenFields: ['id','depid','depname','depcode'],
			columnMenu: true,
			columnShowhide: true,
			columnFilter: true,
			columnLock: false,
			dblOnClick: 'guest_distribution_table_onclick',
		});

	
	function guest_distribution_table_onclick() {
		var selected = $("#guest_distribution_table").data('selectedDatas');
		if (selected.length == 0) {
			$(this).alertmsg('warn', '请在列表中选择要操作的对象。');
		} else {
			var flower_name = selected[0].flower_name;
			var id = selected[0].id;
			var depname = selected[0].depname;
			var depcode = selected[0].depcode;

			$.ajax({
				url: '/v1/newcustomer/distribution',
				dataType: 'json',
				type: 'POST',
				data:{
					gid:g_f_id,
					mobilesalesid:id,
					mobilesales:flower_name,
					mobilesalesdepname:depname,
					mobilesalescode:depcode
				},
				xhrFields: {
					withCredentials: true
				},
				crossDomain: true,
				success: function (d) {
					if (d.state == 200) {
						$(this).alertmsg('ok', '操作成功');
						BJUI.dialog('closeCurrent', this);
						$('#customer_new_guest').datagrid('refresh_part');
					}else{
						$(this).alertmsg('warn', '操作失败');
					}
				}
			});
		}
	}
	
</script>
<div class="bjui-pageContent">
	<button type="button" class="btn btn-blue" data-icon="plus" onclick="guest_distribution_table_onclick()"><i
			class="fa fa-plus"></i>选择
	</button>
	<button type="button" class="btn-close btn" data-icon="close"><i class="fa fa-close"></i> 关闭</button>
	<table id="guest_distribution_table" class="table table-hover" data-width="100%"></table>
</div>