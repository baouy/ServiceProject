<!DOCTYPE html>
<html lang="en">
<head>
    <script type="text/javascript">
        var front_stateids = [1,19,20,21,22,23,24,25]; // 新增、待跟进、已邀约、已分配、已到场(签到)、接待中、已付定金、已签约
        $('#customer_checkin_list').datagrid({

            local: 'remote',
            dataUrl: '/v1/newcustomer/frontdesk_customerlist?statelist='+front_stateids,
            dataType: 'json',
            sortAll: false,
            loadType: 'get',
            filterAll: true,
			height:'95%',
            columns: [{name: 'customercode', width: '150', label: '编码'},
                {name: 'cusname', width: '150', label: '姓名'},
                {name: 'mobile', width: '100', label: '手机号'},
                {name: 'community', width: '150', label: '小区名称'},
                {name: 'area', width: '50', label: '面积'},
                {name: 'state', width: '90', label: '状态',type:'select',items: [{'新增': '新增'}, {'待跟进': '待跟进'}, {'已邀约': '已邀约'}, {'已分配': '已分配'}, {'已签到': '已签到'}, {'接待中': '接待中'}, {'已付定金': '已付定金'},{'已签约': '已签约'},{'施工中': '施工中'},{'已竣工': '已竣工'}]},
                {name: 'marktime', width: '150', label: '预约日期',type:'date',pattern:'yyyy-MM-dd'},
                {name: 'mobilesalesdepname', width: '70', label: '美客部门',type:'select',items:function(){
                    return mobilesalesdepname_content;
                }},
                {name: 'mobilesales', width: '70', label: '美客员',type:'select',items:function(){
                    return mobilesales_content;
                }},
                {name: 'custsalesdepname', width: '70', label: '销售部门',type:'select',items:function(){
                    return custsalesdepname_content;
                }},
                {name: 'custsales', width: '150', label: '客户经理'},
                {name: 'createtime', width: '150', label: '注册时间',type:'date',pattern:'yyyy-MM-dd'},
                {name: 'source', width: '150', label: '来源',type:'select',items:function(){
                    return source_content;
                }},
                {name: 'id', width: '80', label: '主键', hide: true}],
            paging: {pageSize: 50, selectPageSize: '50,100,200', pageCurrent: 1},
            columnMenu: true,
            columnShowhide: true,
            columnFilter: true,
            columnLock: false,
            fullGrid: false,
        });

        function check_notice(){
            var selected = $("#customer_checkin_list").data('selectedDatas');
            $.ajax({
                url: "/v1/newcustomer/checkin_notice?ids=" + selected[0].id,
                type: "POST",
                dataType: "json",
                success: function (data) {
                    if(data.state == 200) {
                        $("#checkin_tips").alertmsg('ok', '签到成功!',{displayMode:'fade',alertTimeout:1000,displayPosition:'middlecenter'});
                        $('#customer_checkin_list').datagrid('refresh_part');
                    }else{
                        $("#checkin_tips").alertmsg('warn', data.content,{displayMode:'fade',alertTimeout:1000,displayPosition:'middlecenter'});
                    }
                }
            })
        }

        function doCheckin() {
            var selectedRows = $('#customer_checkin_list').data('selectedTrs');
            if(null == selectedRows || selectedRows.length == 0) {
                $(this).alertmsg('error', '请在列表中选择要操作的对象。');
            }else {
                $(this).alertmsg('confirm', '确认客户到店',
                        { displayMode:'slide', displayPosition:'middlecenter', okName:'确认', cancelName:'关闭', title:'签到',
                            okCall:'check_notice'})
            }
        }

        function doCheckinRefresh(){
            $('#customer_checkin_list').datagrid('refresh');
        }

    </script>
</head>
<body>
<div class="bjui-pageContent">
    <div style="margin:0px 0px 10px 0px;">
        <button type="button" class="btn btn-blue" data-icon="plus" data-url="FrontDeskManagement/new_customer_add.html" data-toggle="dialog" data-id="add_btn" data-mask="true" data-width="600" data-height="500"><i class="fa fa-plus"></i> 添加自然到店 </button>

        <button type="button" class="btn btn-green" data-icon="edit" onclick="doCheckin()"><i class="fa fa-edit"></i> 签到</button>
    </div>
    <table id="customer_checkin_list" class="table table-hover" data-width="100%"></table>
    <div id="checkin_tips"></div>
</div>
</body>
</html>