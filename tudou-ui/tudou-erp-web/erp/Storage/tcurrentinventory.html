<!DOCTYPE html>
<html lang="en">
<head>
    <script type="text/javascript">
        $("#tcurrentinventory_list").datagrid({ //采购订单列表
            local: 'remote',
            dataUrl: '/v1/currentinventory/currentinventorylist',
            dataType: 'json',
            sortAll: true,
            loadType: 'get',
            filterAll: true,
            height:'95%',
            columns: [
                {name: 'warehousename', width: '150', label: '仓库'},
                {name: 'locationname', width: '150', label: '库位'},
                {name: 'itemno', width: '150', label: '料号'},
                {name: 'qty', width: '150', label: '数量'},
                {name: 'takeupqty', width: '150', label: '占用数'},
                {name: 'brand', width: '150', label: '品牌'},
                {name: 'partname', width: '150', label: '品名'},
                {name: 'partspec', width: '150', label: '规格'},
                {name: 'partstyle', width: '150', label: '型号'},
                {name: 'colorlevel', width: '150', label: '颜色'},
                {name: 'material', width: '150', label: '材质'},
                {name: 'funit', width: '150', label: '单位'},
                {name: 'batchno', width: '150', label: '入库批次'},
                {name: 'orgname', width: '150', label: '组织'},
                {name: 'id', width: '80', label: '主键', hide: true}
            ],
            showLinenumber: true,
            paging: {pageSize: 20, selectPageSize: '50,80', pageCurrent: 1},
            columnMenu: true,
            columnShowhide: true,
            columnFilter: true,
            columnLock: false,
            fullGrid: false,
        });

        /**
         * 审核
         */
        function tcurrentinventory_list_audit(){
            var selected = $("#tcurrentinventory_list").find('tr.datagrid-selected-tr');
            if (selected.length == 0) {
                BJUI.alertmsg('error', '请在列表中选择要操作的对象。');
                BJUI.dialog('closeCurrent',this);
            } else if (selected.length > 1) {
                BJUI.alertmsg('error', '请选择唯一的操作对象。');
                BJUI.dialog('closeCurrent',this);
            } else {
                $.ajax({
                    url: '/v1/currentinventory/reviewedcurrentinventory',
                    dataType: 'json',
                    type: 'POST',
                    data:{
                        id:selected[0].lastChild.innerText
                    },
                    xhrFields: {
                        withCredentials: true
                    },
                    crossDomain: true,
                    success: function (d) {
                        if(d.state ==200) {
                            BJUI.alertmsg('info', d.content,{displayMode:'fade',alertTimeout:1000,displayPosition:'middlecenter'});
                            $('#tcurrentinventory_list').datagrid("refresh");
                        }else  {
                            BJUI.alertmsg('info', d.content,{displayMode:'fade',alertTimeout:1000,displayPosition:'middlecenter'});
                        }
                    }
                });
            }
        }

        /***
         * 弃审
         * */
        function tcurrentinventory_remove_audit(){

            var selected = $("#tcurrentinventory_list").find('tr.datagrid-selected-tr');
            if (selected.length == 0) {
                BJUI.alertmsg('error', '请在列表中选择要操作的对象。');
                BJUI.dialog('closeCurrent',this);
            } else if (selected.length > 1) {
                BJUI.alertmsg('error', '请选择唯一的操作对象。');
                BJUI.dialog('closeCurrent',this);
            } else {
                $.ajax({
                    url: '/v1/currentinventory/giveupreviewedcurrentinventory',
                    dataType: 'json',
                    type: 'POST',
                    data:{
                        id:selected[0].lastChild.innerText
                    },
                    xhrFields: {
                        withCredentials: true
                    },
                    crossDomain: true,
                    success: function (d) {
                        if(d.state ==200) {
                            BJUI.alertmsg('info', d.content,{displayMode:'fade',alertTimeout:1000,displayPosition:'middlecenter'});
                            $('#tcurrentinventory_list').datagrid("refresh");
                        }else  {
                            BJUI.alertmsg('info', d.content,{displayMode:'fade',alertTimeout:1000,displayPosition:'middlecenter'});
                        }
                    }
                });
            }
        }


        function deletedelivery_apply(){
            var selected = $("#tcurrentinventory_list").find('tr.datagrid-selected-tr')[0].lastChild.innerText;
            $.ajax({
                url: '/v1/currentinventory/deletecurrentinventory',
                dataType: 'json',
                type: 'POST',
                data:{
                    id:selected
                },
                xhrFields: {
                    withCredentials: true
                },
                crossDomain: true,
                success: function (d) {
                    if(d.state ==200) {
                        BJUI.alertmsg('info', d.content,{displayMode:'fade',alertTimeout:1000,displayPosition:'middlecenter'});
                        $('#tcurrentinventory_list').datagrid("refresh");
                    }else  {
                        BJUI.alertmsg('error', d.content,{displayMode:'fade',alertTimeout:1000,displayPosition:'middlecenter'});
                    }
                }
            });
        }
        /**
         * 删除
         * **/
        function tcurrentinventory_del(){
            if(0<$("#tcurrentinventory_list").find('tr.datagrid-selected-tr').length){
                BJUI.alertmsg('confirm', '确定要删除吗?',{displayMode:'fade',displayPosition:'middlecenter',okName:"是",cancelName:"否",okCall:'deletedelivery_apply'});
            }else {
                BJUI.alertmsg('error', '请选择唯一的操作对象。');
            }
        }


        function show_curr_download_alert() {
            $(this).alertmsg('confirm', '确定导出吗?', {okCall: 'tcurrent_download'});
        }

        function tcurrent_download(){
            var warehousename = $("input[name='warehousename']").val();
            var locationname = $("input[name='locationname']").val();
            var itemno = $("input[name='itemno']").val();
            var qty = $("input[name='qty']").val();
            var takeupqty = $("input[name='takeupqty']").val();
            var brand = $("input[name='brand']").val();
            var partname = $("input[name='partname']").val();
            var partspec = $("input[name='partspec']").val();
            var partstyle = $("input[name='partstyle']").val();
            var colorlevel = $("input[name='colorlevel']").val();
            var material = $("input[name='material']").val();
            var funit = $("input[name='funit']").val();
            var batchno = $("input[name='batchno']").val();
            var orgname = $("input[name='orgname']").val();

            var url="/v1/currentinventory/currentinventory_tcurrent_excel?pageCurrent=1&pageSize=10000";

            if(warehousename.length > 0){
                url+="&warehousename="+warehousename;
            }
            if(locationname.length > 0){
                url+="&locationname="+locationname;
            }
            if(itemno.length > 0){
                url+="&itemno="+itemno;
            }
            if(qty.length > 0){
                url+="&qty="+qty;
            }
            if(takeupqty.length > 0){
                url+="&takeupqty="+takeupqty;
            }
            if(brand.length > 0){
                url+="&brand="+brand;
            }
            if(partname.length > 0){
                url+="&partname="+partname;
            }
            if(partspec.length > 0){
                url+="&partspec="+partspec;
            }
            if(partstyle.length > 0){
                url+="&partstyle="+partstyle;
            }
            if(colorlevel.length > 0){
                url+="&colorlevel="+colorlevel;
            }
            if(material.length > 0){
                url+="&material="+material;
            }
            if(funit.length > 0){
                url+="&funit="+funit;
            }
            if(batchno.length > 0){
                url+="&batchno="+batchno;
            }
            if(orgname.length > 0){
                url+="&orgname="+orgname;
            }

            window.open(url);
        }
    </script>
</head>
<body>
<div class="bjui-pageContent">
    <div style="margin:0px 0px 10px 0px;">
        <button type="button" class="btn btn-green" data-icon="sign-out" onclick="show_curr_download_alert()"><i class="fa fa-sign-out"></i> 导出</button>

    </div>
    <table id="tcurrentinventory_list" class="table table-hover" data-width="100%"></table>
</div>
</body>
</html>