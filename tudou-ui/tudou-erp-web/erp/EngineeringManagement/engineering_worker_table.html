<html>

<head>
	<script type="text/javascript">
		$('#engineering_worker_datagrid').datagrid({

			local: 'remote',
			dataUrl: '/v1/user/typelist?roleid=' + e_p_roleid,
			dataType: 'json',
			sortAll: false,
			loadType: 'get',
			filterAll: true,
			height:'95%',
			columns: [
				{name: 'userlevel', width: '90', label: '客户等级'},
				{name: 'id', width: '90', label: '编码'},
				{name: 'flower_name', width: '100', label: '花名'},
				{name: 'qty', width: '100', label: '在建项目数'},
				{name: 'depname', width: '100', label: '部门'},
				{name: 'orgname', width: '100', label: '组织'},
				{name: 'note', width: '150', label: '备注'},
			],
			paging: {pageSize: 50, selectPageSize: '50,100,200', pageCurrent: 1},
			columnMenu: true,
			columnShowhide: true,
			columnFilter: true,
			columnLock: false,
			fullGrid: false,
			dblOnClick: 'selectwklItems',
		});


		function selectwklItems() {
			var selected = $("#engineering_worker_datagrid").find('tr.datagrid-selected-tr');
			if (selected.length == 0) {
				$(this).alertmsg('error', '请在列表中选择要操作的对象。');
			} else if (selected.length > 1) {
				$(this).alertmsg('error', '请选择唯一的操作对象。');
			} else {
				var workerid = selected[0].cells[2].innerText;
				var worker = selected[0].cells[3].innerText;
				$.ajax({
					url: '/v1/project/distribution_worker?worker=' + worker + '&workerid=' + workerid + '&id=' + e_p_id + '&stagenameid=' + e_p_stagenameid + '&contractid=' + e_p_contractid,
					dataType: 'json',
					type: 'POST',
					xhrFields: {
						withCredentials: true
					},
					crossDomain: true,
					success: function (d) {
						if (d.state == 200) {
							$("body").alertmsg('info', '操作成功');
							$('#enginnering_assigned_personnel_datagrid_un').datagrid('refresh');
							$('#enginnering_assigned_personnel_datagrid').datagrid('refresh');
							BJUI.dialog('closeCurrent', this);
						} else {
							$("body").alertmsg('error', '操作失败');
						}
					}
				});
			}
		}
	</script>
</head>

<body>
<div class="bjui-pageContent">
	<div style="margin:15px;">
		<button class="btn-default" onclick="selectwklItems()" data-width="1050" data-height="400">选择</button>
		<button class="btn-close" data-width="1050" data-height="400">关闭</button>
	</div>
	<table id="engineering_worker_datagrid" class="table table-hover" data-width="100%"></table>
</div>
</body>

</html>