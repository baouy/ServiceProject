<script type="text/javascript">

	$('#enginnering_assigned_personnel_datagrid_un').datagrid({

		local: 'remote',
		dataUrl: '/v1/project/assigned_personnel?type=0',
		dataType: 'json',
		sortAll: false,
		loadType: 'get',
		filterAll: true,
		height: '95%',
		columns: [
			{name: 'contractdoc', width: '150', label: '合同单号'},
			{name: 'custname', width: '100', label: '客户姓名'},
			{name: 'mobile', width: '100', label: '手机号'},
			{name: 'community', width: '150', label: '小区'},
			{name: 'districtname', width: '100', label: '区域'},
			{name: 'supervision', width: '100', label: '质检'},
			{name: 'road', width: '100', label: '街道'},
			{name: 'salespackage', width: '100', label: '套餐'},
			{name: 'area', width: '100', label: '面积'},
			{name: 'applydate', width: '100', label: '需求时间'},
			{name: 'stagename', width: '100', label: '工程阶段'},
			{name: 'role', width: '100', label: '工人角色'},
			{name: 'worker', width: '100', label: '工人'},
			{name: 'distributionuser', width: '100', label: '分配人'},
			{name: 'distributiontime', width: '100', label: '分配时间'},
			{name: 'createtime', width: '100', label: '创建时间'},
			{name: 'orgname', width: '100', label: '组织'},
			{name: 'id', width: '80', label: '主键', hide: true},
			{name: 'roleid', width: '80', label: '', hide: true},
			{name: 'stagenameid', width: '80', label: '', hide: true},
			{name: 'contractid', width: '80', label: '', hide: true}
		],
		paging: {pageSize: 20, selectPageSize: '50,100,200', pageCurrent: 1},
		columnMenu: true,
		columnShowhide: true,
		columnFilter: true,
		columnLock: false,
		fullGrid: false,

	});


	function assigned_personnel_changeValue(num) {
		setTimeout(function () {
			if (num == 0) {
				$('#enginnering_assigned_personnel_datagrid_un').datagrid('refresh');
			} else if (num == 1) {
				$('#enginnering_assigned_personnel_datagrid').datagrid('refresh');
			}
		}, 300);
	}

	var e_p_roleid, e_p_id, e_p_stagenameid, e_p_contractid;
	function personnel_undistribution_0(obj) {
		var selected = $("#enginnering_assigned_personnel_datagrid_un").find('tr.datagrid-selected-tr');
		if (selected.length == 0) {
			$(this).alertmsg('error', '请在列表中选择要操作的对象。');
		} else if (selected.length > 1) {
			$(this).alertmsg('error', '请选择唯一的操作对象。');
		} else {
			e_p_id = selected[0].cells[18].innerText;
			e_p_roleid = selected[0].cells[19].innerText;
			e_p_stagenameid = selected[0].cells[20].innerText;
			e_p_contractid = selected[0].cells[21].innerText;


			console.log(e_p_roleid);

			for (var i = 0; i < 22; i++) {
				console.log(selected[0].cells[i].innerText);
			}

			$(obj).dialog({
				id: 'engineering_worker_table',
				url: 'EngineeringManagement/engineering_worker_table.html',
				title: '分配工人',
				width: '700',
				height: '400',
				mask: true
			});
		}
	}

	function personnel_undistribution_1(obj) {
		var selected = $("#enginnering_assigned_personnel_datagrid").find('tr.datagrid-selected-tr');
		if (selected.length == 0) {
			$(this).alertmsg('error', '请在列表中选择要操作的对象。');
		} else if (selected.length > 1) {
			$(this).alertmsg('error', '请选择唯一的操作对象。');
		} else {
			e_p_id = selected[0].cells[18].innerText;
			e_p_roleid = selected[0].cells[19].innerText;
			e_p_stagenameid = selected[0].cells[20].innerText;
			e_p_contractid = selected[0].cells[21].innerText;
			$(obj).dialog({
				id: 'engineering_worker_table',
				url: 'EngineeringManagement/engineering_worker_table.html',
				title: '分配工人',
				width: '700',
				height: '400',
				mask: true
			});
		}
	}

</script>
<div class="bjui-pageContent" style="height: 100%">

	<ul class="nav nav-tabs" role="tablist" id="customer_design_menuTab">
		<li class="active">
			<a style="font-size: 13px" href="#assigned_personnel_undistribution" role="tab" data-toggle="tab"
			   onclick="assigned_personnel_changeValue(0)">未分配</a>
		</li>
		<li>
			<a style="font-size: 13px" href="EngineeringManagement/enginnering_assigned_personnel_table_1.html" role="tab" data-toggle="ajaxtab" data-target="#assigned_personnel_distribution"
			   onclick="assigned_personnel_changeValue(1)">已分配</a>
		</li>
	</ul>
	<div class="tab-content" style="height: 95%">
		<div class="tab-pane fade active in" id="assigned_personnel_undistribution" style="height: 100%;">
			<div style="margin-bottom:10px;">
				<button type="button" class="btn btn-green" data-icon="list-alt"
						onclick="personnel_undistribution_0(this)">分配工人
				</button>
			</div>
			<table id="enginnering_assigned_personnel_datagrid_un"></table>
		</div>

		<div class="tab-pane fade" id="assigned_personnel_distribution" style="height: 100%;">

		</div>
	</div>
</div>