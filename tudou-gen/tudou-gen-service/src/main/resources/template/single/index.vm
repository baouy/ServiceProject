#set ($pk = '')
<script>
    layui.define(['BJUIajax', 'BJUIdatagrid', 'BJUIinitui', 'BJUIplugins'],function () {
        var $ = layui.jquery
        var ${smodule}_btn = ''
        var toolbar_${smodule}_btn = '<div class="layui-btn-group">';
        for (var data of user_data) {
            var value = data.permissionValue;
            switch (value){
                case '${permissions}:create':
                    toolbar_${smodule}_btn += '<button type="button" id="${smodule}_add_btn" name="' + data.name + '" url="' + data.uri + '" class="layui-btn layui-btn-small" w="1500" h="700">' + '<i class="layui-icon">'+data.icon+'</i>&nbsp;' + data.name + ' </button>'
                    break;
                case '${permissions}:update':
                    toolbar_${smodule}_btn += '<button type="button" id="${smodule}_edit_btn" name="' + data.name + '" url="' + data.uri + '" class="layui-btn layui-btn-small" w="1500" h="700">' + '<i class="layui-icon">'+data.icon+'</i>&nbsp;' + data.name + ' </button>'
                    break;
                case '${permissions}:delete':
						${smodule}_btn += 'del,'
                    break;
            }
        }
        toolbar_${smodule}_btn += '</div>';

        var ${smodule}_datagrid_data = {
            local: 'remote',
            dataUrl: $.cookie("tudou-${smodel}-server")+'/manage/${smodule}/list',
            dataType: 'json',
            sortAll: false,
            loadType: 'get',
            filterAll: true,
            height:'100%',
            columns: [
				#foreach($i in $columns)
					#if($i.isList == 1)
                        #if($i.isPk == 1)
                            {name:'${i.javaField}', hide:true},
                        #elseif($i.showType == "dateselect")
                            {name:'${i.javaField}', width:'150',align : 'center', label:'${i.comments}',render:function (value) {
                                return zjoin.timetrans(value);
                            }},
                        #elseif($i.showType == "select")
                            {name:'${i.javaField}', width:'120',align : 'center', label:'${i.comments}',type: 'select', items: ${i.dictType}},
                        #elseif($i.showType == "radiobox")
                            {name:'${i.javaField}', width:'80',align : 'center', label:'${i.comments}',type: 'select',items: [{'0': '否'}, {'1': '是'}]},
                        #elseif($i.showType == "checkbox")
                            {name:'${i.javaField}', width:'150',align : 'center', label:'${i.comments}',type: 'select', attrs:{multiple:true},items: ${i.dictType},render:function (value) {
                                var arr = value.split(","),v ='';
                                for(var d of arr){
                                    for(var x of ${i.dictType}){
                                        if(x[d]) v += x[d]+';';continue
                                    }
                                }
                                return v;
                            }},
                        #else
                            {name:'${i.javaField}', width:'100',align : 'center', label:'${i.comments}'},
                        #end
					#end
					#if($i.isPk == 1)
						#set ($pk = ${i.javaField})
					#end
				#end
            ],
            paging: {pageSize:50, selectPageSize:'50,100,200', pageCurrent:1},
            fullGrid: true,
            showToolbar: true,
            toolbarItem: ${smodule}_btn,
            inlineEditMult: false,
            toolbarCustom: toolbar_${smodule}_btn,
            dblOnClick: '${smodule}_dblonclick',
        }

        if (${smodule}_btn.indexOf('del') != -1) {
				${smodule}_datagrid_data.delConfirm = true
				${smodule}_datagrid_data.delPK = '$pk'
				${smodule}_datagrid_data.delType = 'POST'
				${smodule}_datagrid_data.delUrl = $.cookie("tudou-${smodel}-server") + '/manage/${smodule}/delete'
				${smodule}_datagrid_data.delCallback = 'del_${smodule}_table_back'
        }

        $('#${smodule}_list_table').datagrid(${smodule}_datagrid_data);
        window.del_${smodule}_table_back = del_${smodule}_table_back;
        function del_${smodule}_table_back(d) {
            if (d.code == 1) {
                layer.ok( '删除成功');
            } else {
                layer.warn( d.data);
            }
            $('#${smodule}_list_table').data('selectedDatas',null);
            $('#${smodule}_list_table').datagrid('refresh_part');
        }

        $("#${smodule}_add_btn").bind('click',function () {
            var n = $(this);
            //layer.dialog(n.attr("name"), n.attr("url"), n.attr("w"), n.attr("h"));
            var w= window.innerWidth*0.8,h = window.innerHeight*0.8;
            var selected = $('#${smodule}_list_table').data('selectedTrs');
            if(selected) selected.click();//避免有选中数据的时候点新增会触发编辑
            layer.dialog(n.attr("name"), n.attr("url"), w, h);
        });

        window.${smodule}_dblonclick=${smodule}_dblonclick;
        function ${smodule}_dblonclick() {
            $("#${smodule}_edit_btn").click();
        }

        $("#${smodule}_edit_btn").bind('click',function () {
            var selected = $('#${smodule}_list_table').data('selectedDatas');
            if (null == selected || selected.length == 0) {
                layer.warn("请选择操作数据！")
                return;
            }
            var n = $(this);
            //layer.dialog(n.attr("name"), n.attr("url"), n.attr("w"), n.attr("h"));
            var w= window.innerWidth*0.8,h = window.innerHeight*0.8;
            layer.dialog(n.attr("name"), n.attr("url"), w, h);
        });
    });
</script>

<div class="bjui-pageContent" >
	<table id="${smodule}_list_table" class="table table-hover" data-width="100%"> </table>
</div>